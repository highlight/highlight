query GetSessionPayload($session_id: ID!) {
    events(session_id: $session_id)
    errors(session_id: $session_id) {
        ...errorFields
    }
}

query GetSession($id: ID!) {
    session(id: $id) {
        os_name
        os_version
        browser_name
        browser_version
        environment
        app_version
        city
        state
        postal
        fingerprint
        created_at
        language
        user_object
        identifier
        starred
        enable_strict_privacy
        enable_recording_network_contents
        field_group
        fields {
            name
            value
            type
        }
        object_storage_enabled
        payload_size
        within_billing_quota
        client_version
        is_public
    }
}

query GetAdmins($organization_id: ID!) {
    admins(organization_id: $organization_id) {
        id
        name
        email
        photo_url
    }
}

query GetSessionComments($session_id: ID!) {
    session_comments(session_id: $session_id) {
        id
        timestamp
        session_id
        created_at
        updated_at
        organization_id
        text
        author {
            id
            name
            email
            photo_url
        }
        x_coordinate
        y_coordinate
        type
        metadata
    }
}

query GetNotifications($organization_id: ID!) {
    session_comments_for_organization(organization_id: $organization_id) {
        id
        timestamp
        updated_at
        session_id
        text
        author {
            id
            name
            email
            photo_url
        }
        type
        metadata
    }
    error_comments_for_organization(organization_id: $organization_id) {
        id
        updated_at
        organization_id
        text
        error_id
        author {
            id
            name
            email
            photo_url
        }
    }
}

query GetSessionCommentsForAdmin {
    session_comments_for_admin {
        id
        timestamp
        created_at
        organization_id
        updated_at
        text
        author {
            id
            name
            email
            photo_url
        }
    }
}

query GetErrorComments($error_group_id: ID!) {
    error_comments(error_group_id: $error_group_id) {
        id
        created_at
        updated_at
        text
        organization_id
        author {
            id
            name
            email
            photo_url
        }
    }
}

query GetOnboardingSteps($organization_id: ID!, $admin_id: ID!) {
    organization(id: $organization_id) {
        slack_channels
    }
    admins(organization_id: $organization_id) {
        id
    }
    isIntegrated(organization_id: $organization_id)
    adminHasCreatedComment(admin_id: $admin_id)
    organizationHasViewedASession(organization_id: $organization_id) {
        id
    }
    admin {
        slack_im_channel_id
    }
}

mutation SendAdminInvite(
    $organization_id: ID!
    $email: String!
    $base_url: String!
) {
    sendAdminInvite(
        organization_id: $organization_id
        email: $email
        base_url: $base_url
    )
}

query GetSessions(
    $organization_id: ID!
    $count: Int!
    $lifecycle: SessionLifecycle!
    $starred: Boolean!
    $params: SearchParamsInput
) {
    sessions(
        organization_id: $organization_id
        count: $count
        lifecycle: $lifecycle
        starred: $starred
        params: $params
    ) {
        sessions {
            id
            fingerprint
            identifier
            os_name
            os_version
            browser_name
            browser_version
            city
            state
            postal
            created_at
            language
            length
            active_length
            enable_recording_network_contents
            viewed
            starred
            processed
            field_group
            fields {
                name
                value
                type
                id
            }
            first_time
        }
        totalCount
    }
}

query GetOrganizations {
    organizations {
        id
        name
    }
}

# Gets the current application and all applications the admin has access to.
query GetApplications($id: ID!) {
    organizations {
        id
        name
    }
    organization(id: $id) {
        id
        name
        verbose_id
        billing_email
        slack_webhook_channel
        secret
    }
}

query GetAdmin {
    admin {
        id
        name
        email
        photo_url
        slack_im_channel_id
    }
}

query GetOrganization($id: ID!) {
    organization(id: $id) {
        id
        name
        verbose_id
        billing_email
        slack_webhook_channel
        secret
    }
}

query GetBillingDetails($organization_id: ID!) {
    billingDetails(organization_id: $organization_id) {
        plan {
            type
            quota
        }
        meter
        sessionsOutOfQuota
    }
    organization(id: $organization_id) {
        id
        trial_end_date
    }
}

query GetErrorGroup($id: ID!) {
    error_group(id: $id) {
        created_at
        id
        type
        organization_id
        event
        state
        stack_trace {
            fileName
            lineNumber
            functionName
            columnNumber
        }
        mapped_stack_trace
        metadata_log {
            error_id
            session_id
            environment
            timestamp
            os
            browser
            visited_url
            fingerprint
            identifier
        }
        field_group {
            name
            value
        }
        error_frequency
    }
}

query GetErrorGroups(
    $organization_id: ID!
    $count: Int!
    $params: ErrorSearchParamsInput
) {
    error_groups(
        organization_id: $organization_id
        count: $count
        params: $params
    ) {
        error_groups {
            created_at
            id
            type
            event
            state
            state
            environments
            stack_trace {
                fileName
                lineNumber
                functionName
                columnNumber
            }
            metadata_log {
                error_id
                session_id
                timestamp
            }
            error_frequency
        }
        totalCount
    }
}

query GetMessages($session_id: ID!) {
    messages(session_id: $session_id)
}

query GetResources($session_id: ID!) {
    resources(session_id: $session_id)
}

fragment errorFields on ErrorObject {
    id
    error_group_id
    event
    type
    url
    source
    stack_trace
    timestamp
    payload
}

query GetFieldSuggestion(
    $organization_id: ID!
    $name: String!
    $query: String!
) {
    field_suggestion(
        organization_id: $organization_id
        name: $name
        query: $query
    ) {
        name
        value
    }
}

query GetOrganizationSuggestion($query: String!) {
    organizationSuggestion(query: $query) {
        id
        name
    }
}

query GetErrorFieldSuggestion(
    $organization_id: ID!
    $name: String!
    $query: String!
) {
    error_field_suggestion(
        organization_id: $organization_id
        name: $name
        query: $query
    ) {
        name
        value
    }
}

query GetErrorSearchSuggestions($organization_id: ID!, $query: String!) {
    visitedUrls: error_field_suggestion(
        organization_id: $organization_id
        name: "visited_url"
        query: $query
    ) {
        name
        value
    }
    fields: error_field_suggestion(
        organization_id: $organization_id
        name: "event"
        query: $query
    ) {
        name
        value
    }
}

query GetSessionSearchResults($organization_id: ID!, $query: String!) {
    trackProperties: property_suggestion(
        organization_id: $organization_id
        query: $query
        type: "track"
    ) {
        id
        name
        value
    }
    userProperties: property_suggestion(
        organization_id: $organization_id
        query: $query
        type: "user"
    ) {
        id
        name
        value
    }
    visitedUrls: field_suggestion(
        organization_id: $organization_id
        name: "visited-url"
        query: $query
    ) {
        id
        name
        value
    }
    referrers: field_suggestion(
        organization_id: $organization_id
        name: "referrer"
        query: $query
    ) {
        id
        name
        value
    }
}

query GetTrackSuggestion($organization_id: ID!, $query: String!) {
    property_suggestion(
        organization_id: $organization_id
        query: $query
        type: "track"
    ) {
        id
        name
        value
    }
}

query GetUserSuggestion($organization_id: ID!, $query: String!) {
    property_suggestion(
        organization_id: $organization_id
        query: $query
        type: "user"
    ) {
        id
        name
        value
    }
}

query GetSegments($organization_id: ID!) {
    segments(organization_id: $organization_id) {
        id
        name
        params {
            user_properties {
                name
                value
            }
            excluded_properties {
                name
                value
            }
            track_properties {
                name
                value
            }
            date_range {
                start_date
                end_date
            }
            length_range {
                min
                max
            }
            os
            browser
            visited_url
            referrer
            identified
            hide_viewed
            first_time
        }
    }
}

query GetErrorSegments($organization_id: ID!) {
    error_segments(organization_id: $organization_id) {
        id
        name
        params {
            date_range {
                start_date
                end_date
            }
            os
            browser
            visited_url
            state
            event
        }
    }
}

query IsIntegrated($organization_id: ID!) {
    isIntegrated(organization_id: $organization_id)
}

query UnprocessedSessionsCount($organization_id: ID!) {
    unprocessedSessionsCount(organization_id: $organization_id)
}

query GetKeyPerformanceIndicators(
    $organization_id: ID!
    $lookBackPeriod: Int!
) {
    unprocessedSessionsCount(organization_id: $organization_id)
    newUsersCount(
        organization_id: $organization_id
        lookBackPeriod: $lookBackPeriod
    ) {
        count
    }
    averageSessionLength(
        organization_id: $organization_id
        lookBackPeriod: $lookBackPeriod
    ) {
        length
    }
    userFingerprintCount(
        organization_id: $organization_id
        lookBackPeriod: $lookBackPeriod
    ) {
        count
    }
}

query GetReferrersCount($organization_id: ID!, $lookBackPeriod: Int!) {
    referrers(
        organization_id: $organization_id
        lookBackPeriod: $lookBackPeriod
    ) {
        host
        count
        percent
    }
}

query GetNewUsersCount($organization_id: ID!, $lookBackPeriod: Int!) {
    newUsersCount(
        organization_id: $organization_id
        lookBackPeriod: $lookBackPeriod
    ) {
        count
    }
}

query GetAverageSessionLength($organization_id: ID!, $lookBackPeriod: Int!) {
    averageSessionLength(
        organization_id: $organization_id
        lookBackPeriod: $lookBackPeriod
    ) {
        length
    }
}

query GetTopUsers($organization_id: ID!, $lookBackPeriod: Int!) {
    topUsers(
        organization_id: $organization_id
        lookBackPeriod: $lookBackPeriod
    ) {
        identifier
        total_active_time
        active_time_percentage
        id
    }
}

query GetDailySessionsCount(
    $organization_id: ID!
    $date_range: DateRangeInput!
) {
    dailySessionsCount(
        organization_id: $organization_id
        date_range: $date_range
    ) {
        date
        count
    }
}

query GetDailyErrorsCount($organization_id: ID!, $date_range: DateRangeInput!) {
    dailyErrorsCount(
        organization_id: $organization_id
        date_range: $date_range
    ) {
        date
        count
    }
}

query GetDailyErrorFrequency(
    $organization_id: ID!
    $error_group_id: ID!
    $date_offset: Int!
) {
    dailyErrorFrequency(
        organization_id: $organization_id
        error_group_id: $error_group_id
        date_offset: $date_offset
    )
}

query GetErrorAlert($organization_id: ID!) {
    error_alert(organization_id: $organization_id) {
        ChannelsToNotify {
            webhook_channel
            webhook_channel_id
        }
        ExcludedEnvironments
        CountThreshold
    }
}

query GetNewUserAlert($organization_id: ID!) {
    new_user_alert(organization_id: $organization_id) {
        ChannelsToNotify {
            webhook_channel
            webhook_channel_id
        }
        ExcludedEnvironments
        CountThreshold
    }
}

query GetTrackPropertiesAlert($organization_id: ID!) {
    track_properties_alert(organization_id: $organization_id) {
        ChannelsToNotify {
            webhook_channel
            webhook_channel_id
        }
        ExcludedEnvironments
        CountThreshold
    }
}

query GetUserPropertiesAlert($organization_id: ID!) {
    user_properties_alert(organization_id: $organization_id) {
        ChannelsToNotify {
            webhook_channel
            webhook_channel_id
        }
        ExcludedEnvironments
        CountThreshold
    }
}

query GetEnvironmentSuggestion($query: String!, $organization_id: ID!) {
    environment_suggestion(query: $query, organization_id: $organization_id) {
        name
        value
    }
}

query GetSlackChannelSuggestion($organization_id: ID!) {
    slack_channel_suggestion(organization_id: $organization_id) {
        webhook_channel
        webhook_channel_id
    }
}

query GetAlertsPagePayload($organization_id: ID!) {
    slack_channel_suggestion(organization_id: $organization_id) {
        webhook_channel
        webhook_channel_id
    }
    environment_suggestion(query: "q", organization_id: $organization_id) {
        name
        value
    }
    error_alert(organization_id: $organization_id) {
        ChannelsToNotify {
            webhook_channel
            webhook_channel_id
        }
        ExcludedEnvironments
        CountThreshold
        ThresholdWindow
        id
    }
    new_user_alert(organization_id: $organization_id) {
        id
        ChannelsToNotify {
            webhook_channel
            webhook_channel_id
        }
        ExcludedEnvironments
        CountThreshold
    }
    track_properties_alert(organization_id: $organization_id) {
        id
        ChannelsToNotify {
            webhook_channel
            webhook_channel_id
        }
        TrackProperties {
            id
            name
            value
        }
        ExcludedEnvironments
        CountThreshold
    }
    user_properties_alert(organization_id: $organization_id) {
        id
        ChannelsToNotify {
            webhook_channel
            webhook_channel_id
        }
        UserProperties {
            id
            name
            value
        }
        ExcludedEnvironments
        CountThreshold
    }
}
