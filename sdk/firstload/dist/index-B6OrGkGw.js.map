{"version":3,"file":"index-B6OrGkGw.js","sources":["../src/integrations/amplitude.ts","../../client/src/utils/sessionStorage/sessionStorageKeys.ts","../src/integrations/mixpanel.ts","../../client/src/utils/utils.ts","../../../node_modules/stackframe/stackframe.js","../../../node_modules/error-stack-parser/error-stack-parser.js","../../client/src/listeners/console-listener.tsx","../../../node_modules/json-stringify-safe/stringify.js","../../client/src/listeners/error-listener.tsx","../../client/src/types/client.ts","../../client/src/constants/errors.ts","../../client/src/listeners/network-listener/utils/network-sanitizer.ts","../../client/src/utils/storage.ts","../../client/src/constants/sessions.ts","../../client/src/utils/sessionStorage/highlightSession.ts","../../client/src/listeners/network-listener/utils/utils.ts","../../client/src/listeners/network-listener/utils/xhr-listener.ts","../../client/src/listeners/network-listener/utils/fetch-listener.ts","../../client/src/listeners/network-listener/utils/web-socket-listener.ts","../../client/src/listeners/network-listener/network-listener.ts","../../client/src/listeners/first-load-listeners.tsx","../../client/src/utils/secure-id.ts","../src/integrations/segment.ts","../src/environments/electron.ts","../src/__generated/version.ts","../src/listeners/fetch/index.ts","../src/listeners/web-socket/index.ts","../src/browserExtension/extensionListener.ts","../src/index.tsx"],"sourcesContent":["// @ts-nocheck\nimport type { AmplitudeIntegrationOptions } from '@highlight-run/client/src/types/client'\nimport type { Integration } from '@highlight-run/client/src/types/types'\n\ninterface Window {\n\tamplitude?: AmplitudeAPI\n}\n\ndeclare var window: Window\n\nexport const setupAmplitudeIntegration: Integration = ({\n\tapiKey,\n}: AmplitudeIntegrationOptions) => {\n\t;(function (e, t) {\n\t\tvar n = e.amplitude || { _q: [], _iq: {} }\n\t\tvar r = t.createElement('script')\n\t\tr.type = 'text/javascript'\n\t\tr.integrity =\n\t\t\t'sha384-+EO59vL/X7v6VE2s6/F4HxfHlK0nDUVWKVg8K9oUlvffAeeaShVBmbORTC2D3UF+'\n\t\tr.crossOrigin = 'anonymous'\n\t\tr.async = true\n\t\tr.src = 'https://cdn.amplitude.com/libs/amplitude-8.17.0-min.gz.js'\n\t\tr.onload = function () {\n\t\t\tif (!e.amplitude.runQueuedFunctions) {\n\t\t\t\tconsole.log('[Amplitude] Error: could not load SDK')\n\t\t\t}\n\t\t\tamplitude.getInstance().init(apiKey)\n\t\t}\n\t\tvar i = t.getElementsByTagName('script')[0]\n\t\ti.parentNode.insertBefore(r, i)\n\t\tfunction s(e, t) {\n\t\t\te.prototype[t] = function () {\n\t\t\t\tthis._q.push(\n\t\t\t\t\t[t].concat(Array.prototype.slice.call(arguments, 0)),\n\t\t\t\t)\n\t\t\t\treturn this\n\t\t\t}\n\t\t}\n\t\tvar o = function () {\n\t\t\tthis._q = []\n\t\t\treturn this\n\t\t}\n\t\tvar a = [\n\t\t\t'add',\n\t\t\t'append',\n\t\t\t'clearAll',\n\t\t\t'prepend',\n\t\t\t'set',\n\t\t\t'setOnce',\n\t\t\t'unset',\n\t\t\t'preInsert',\n\t\t\t'postInsert',\n\t\t\t'remove',\n\t\t]\n\t\tfor (var c = 0; c < a.length; c++) {\n\t\t\ts(o, a[c])\n\t\t}\n\t\tn.Identify = o\n\t\tvar u = function () {\n\t\t\tthis._q = []\n\t\t\treturn this\n\t\t}\n\t\tvar l = [\n\t\t\t'setProductId',\n\t\t\t'setQuantity',\n\t\t\t'setPrice',\n\t\t\t'setRevenueType',\n\t\t\t'setEventProperties',\n\t\t]\n\t\tfor (var p = 0; p < l.length; p++) {\n\t\t\ts(u, l[p])\n\t\t}\n\t\tn.Revenue = u\n\t\tvar d = [\n\t\t\t'init',\n\t\t\t'logEvent',\n\t\t\t'logRevenue',\n\t\t\t'setUserId',\n\t\t\t'setUserProperties',\n\t\t\t'setOptOut',\n\t\t\t'setVersionName',\n\t\t\t'setDomain',\n\t\t\t'setDeviceId',\n\t\t\t'enableTracking',\n\t\t\t'setGlobalUserProperties',\n\t\t\t'identify',\n\t\t\t'clearUserProperties',\n\t\t\t'setGroup',\n\t\t\t'logRevenueV2',\n\t\t\t'regenerateDeviceId',\n\t\t\t'groupIdentify',\n\t\t\t'onInit',\n\t\t\t'logEventWithTimestamp',\n\t\t\t'logEventWithGroups',\n\t\t\t'setSessionId',\n\t\t\t'resetSessionId',\n\t\t]\n\t\tfunction v(e) {\n\t\t\tfunction t(t) {\n\t\t\t\te[t] = function () {\n\t\t\t\t\te._q.push(\n\t\t\t\t\t\t[t].concat(Array.prototype.slice.call(arguments, 0)),\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var n = 0; n < d.length; n++) {\n\t\t\t\tt(d[n])\n\t\t\t}\n\t\t}\n\t\tv(n)\n\t\tn.getInstance = function (e) {\n\t\t\te = (!e || e.length === 0 ? '$default_instance' : e).toLowerCase()\n\t\t\tif (!Object.prototype.hasOwnProperty.call(n._iq, e)) {\n\t\t\t\tn._iq[e] = { _q: [] }\n\t\t\t\tv(n._iq[e])\n\t\t\t}\n\t\t\treturn n._iq[e]\n\t\t}\n\t\te.amplitude = n\n\t})(window, document)\n}\n\nexport interface AmplitudeAPI {\n\tinit: (token: string) => void\n\ttrack: (event_name: string, properties?: any, options?: any) => void\n\tidentify: (unique_id: string) => void\n\tIdentify: any\n\tgetInstance: () => any\n}\n","export enum SESSION_STORAGE_KEYS {\n\tRECORDING_START_TIME = 'highlightRecordingStartTime',\n\tSEGMENT_LAST_SENT_HASH_KEY = 'HIGHLIGHT_SEGMENT_LAST_SENT_HASH_KEY',\n\tSESSION_DATA = 'sessionData',\n\tSESSION_SECURE_ID = 'sessionSecureID',\n\tUSER_IDENTIFIER = 'highlightIdentifier',\n\tUSER_OBJECT = 'highlightUserObject',\n\tPAYLOAD_ID = 'payloadId',\n}\n","// @ts-nocheck\nimport type { MixpanelIntegrationOptions } from '@highlight-run/client/src/types/client'\nimport type { Integration } from '@highlight-run/client/src/types/types'\n\ninterface Window {\n\tmixpanel?: MixpanelAPI\n}\n\ndeclare var window: Window\n\nexport const setupMixpanelIntegration: Integration = ({\n\tprojectToken,\n}: MixpanelIntegrationOptions) => {\n\tif (window.mixpanel) {\n\t\treturn\n\t}\n\n\t;(function (f, b) {\n\t\tif (!b.__SV) {\n\t\t\tvar i, h\n\t\t\twindow.mixpanel = b\n\t\t\tb._i = []\n\t\t\tb.init = function (e, f, c) {\n\t\t\t\tfunction g(a, d) {\n\t\t\t\t\tvar b = d.split('.')\n\t\t\t\t\t2 == b.length && ((a = a[b[0]]), (d = b[1]))\n\t\t\t\t\ta[d] = function () {\n\t\t\t\t\t\ta.push(\n\t\t\t\t\t\t\t[d].concat(\n\t\t\t\t\t\t\t\tArray.prototype.slice.call(arguments, 0),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar a = b\n\t\t\t\t'undefined' !== typeof c ? (a = b[c] = []) : (c = 'mixpanel')\n\t\t\t\ta.people = a.people || []\n\t\t\t\ta.toString = function (a) {\n\t\t\t\t\tvar d = 'mixpanel'\n\t\t\t\t\t'mixpanel' !== c && (d += '.' + c)\n\t\t\t\t\ta || (d += ' (stub)')\n\t\t\t\t\treturn d\n\t\t\t\t}\n\t\t\t\ta.people.toString = function () {\n\t\t\t\t\treturn a.toString(1) + '.people (stub)'\n\t\t\t\t}\n\t\t\t\ti =\n\t\t\t\t\t'disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove'.split(\n\t\t\t\t\t\t' ',\n\t\t\t\t\t)\n\t\t\t\tfor (h = 0; h < i.length; h++) g(a, i[h])\n\t\t\t\tvar j = 'set set_once union unset remove delete'.split(' ')\n\t\t\t\ta.get_group = function () {\n\t\t\t\t\tfunction b(c) {\n\t\t\t\t\t\td[c] = function () {\n\t\t\t\t\t\t\tcall2_args = arguments\n\t\t\t\t\t\t\tcall2 = [c].concat(\n\t\t\t\t\t\t\t\tArray.prototype.slice.call(call2_args, 0),\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\ta.push([e, call2])\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (\n\t\t\t\t\t\tvar d = {},\n\t\t\t\t\t\t\te = ['get_group'].concat(\n\t\t\t\t\t\t\t\tArray.prototype.slice.call(arguments, 0),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tc = 0;\n\t\t\t\t\t\tc < j.length;\n\t\t\t\t\t\tc++\n\t\t\t\t\t)\n\t\t\t\t\t\tb(j[c])\n\t\t\t\t\treturn d\n\t\t\t\t}\n\t\t\t\tb._i.push([e, f, c])\n\t\t\t}\n\t\t\tb.__SV = 1.2\n\t\t}\n\t})(document, window.mixpanel || [])\n\tconst script = document.createElement('script')\n\tscript.src = MixpanelBundle\n\tdocument.head.appendChild(script)\n\n\tscript.addEventListener('load', () => {\n\t\twindow.mixpanel?.init(projectToken)\n\t})\n}\n\nconst MixpanelBundle = 'https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js'\n\nexport interface MixpanelPeopleAPI {\n\tset: (metadata: { [k: string]: any }) => void\n}\n\nexport interface MixpanelAPI {\n\tinit: (token: string, config?: any, name?: string) => void\n\ttrack: (event_name: string, properties?: any, options?: any) => void\n\tidentify: (unique_id: string) => void\n\tpeople: MixpanelPeopleAPI\n}\n","import { StringifyOptions } from '../listeners/console-listener'\n\nexport function patch(\n\t// tslint:disable-next-line:no-any\n\tsource: { [key: string]: any },\n\tname: string,\n\t// tslint:disable-next-line:no-any\n\treplacement: (...args: any[]) => any,\n): () => void {\n\ttry {\n\t\tif (!(name in source)) {\n\t\t\treturn () => {}\n\t\t}\n\n\t\tconst original = source[name] as () => unknown\n\t\tconst wrapped = replacement(original)\n\n\t\t// Make sure it's a function first, as we need to attach an empty prototype for `defineProperties` to work\n\t\t// otherwise it'll throw \"TypeError: Object.defineProperties called on non-object\"\n\t\t// tslint:disable-next-line:strict-type-predicates\n\t\tif (typeof wrapped === 'function') {\n\t\t\twrapped.prototype = wrapped.prototype || {}\n\t\t\tObject.defineProperties(wrapped, {\n\t\t\t\t__rrweb_original__: {\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\tvalue: original,\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\n\t\tsource[name] = wrapped\n\n\t\treturn () => {\n\t\t\tsource[name] = original\n\t\t}\n\t} catch {\n\t\treturn () => {}\n\t}\n}\n\n/**\n * transfer the node path in Event to string\n * @param node the first node in a node path array\n */\nfunction pathToSelector(node: HTMLElement): string | '' {\n\tif (!node || !node.outerHTML) {\n\t\treturn ''\n\t}\n\n\tlet path = ''\n\twhile (node.parentElement) {\n\t\tlet name = node.localName\n\t\tif (!name) {\n\t\t\tbreak\n\t\t}\n\t\tname = name.toLowerCase()\n\t\tlet parent = node.parentElement\n\n\t\tlet domSiblings = []\n\n\t\tif (parent.children && parent.children.length > 0) {\n\t\t\t// tslint:disable-next-line:prefer-for-of\n\t\t\tfor (let i = 0; i < parent.children.length; i++) {\n\t\t\t\tlet sibling = parent.children[i]\n\t\t\t\tif (sibling.localName && sibling.localName.toLowerCase) {\n\t\t\t\t\tif (sibling.localName.toLowerCase() === name) {\n\t\t\t\t\t\tdomSiblings.push(sibling)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (domSiblings.length > 1) {\n\t\t\tname += ':eq(' + domSiblings.indexOf(node) + ')'\n\t\t}\n\t\tpath = name + (path ? '>' + path : '')\n\t\tnode = parent\n\t}\n\n\treturn path\n}\n\n/**\n * judge is object\n */\nfunction isObject(obj: any): boolean {\n\treturn Object.prototype.toString.call(obj) === '[object Object]'\n}\n\n/**\n * judge the object's depth\n */\nfunction isObjTooDeep(obj: any, limit: number): boolean {\n\tif (limit === 0) {\n\t\treturn true\n\t}\n\n\tconst keys = Object.keys(obj)\n\tfor (const key of keys) {\n\t\tif (isObject(obj[key]) && isObjTooDeep(obj[key], limit - 1)) {\n\t\t\treturn true\n\t\t}\n\t}\n\n\treturn false\n}\n\n/**\n * stringify any js object\n * @param obj the object to stringify\n */\nexport function stringify(\n\tobj: any,\n\tstringifyOptions?: StringifyOptions,\n): string {\n\tconst options: StringifyOptions = {\n\t\tnumOfKeysLimit: 50,\n\t\tdepthOfLimit: 4,\n\t}\n\tObject.assign(options, stringifyOptions)\n\tconst stack: any[] = []\n\tconst keys: any[] = []\n\treturn JSON.stringify(obj, function (key, value) {\n\t\t/**\n\t\t * forked from https://github.com/moll/json-stringify-safe/blob/master/stringify.js\n\t\t * to deCycle the object\n\t\t */\n\t\tif (stack.length > 0) {\n\t\t\tconst thisPos = stack.indexOf(this)\n\t\t\t~thisPos ? stack.splice(thisPos + 1) : stack.push(this)\n\t\t\t~thisPos ? keys.splice(thisPos, Infinity, key) : keys.push(key)\n\t\t\tif (~stack.indexOf(value)) {\n\t\t\t\tif (stack[0] === value) {\n\t\t\t\t\tvalue = '[Circular ~]'\n\t\t\t\t} else {\n\t\t\t\t\tvalue =\n\t\t\t\t\t\t'[Circular ~.' +\n\t\t\t\t\t\tkeys.slice(0, stack.indexOf(value)).join('.') +\n\t\t\t\t\t\t']'\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tstack.push(value)\n\t\t}\n\t\t/* END of the FORK */\n\n\t\tif (value === null || value === undefined) {\n\t\t\treturn value\n\t\t}\n\t\tif (shouldIgnore(value)) {\n\t\t\treturn toString(value)\n\t\t}\n\t\tif (value instanceof Event) {\n\t\t\tconst eventResult: any = {}\n\t\t\tfor (const eventKey in value) {\n\t\t\t\tconst eventValue = (value as any)[eventKey]\n\t\t\t\tif (Array.isArray(eventValue)) {\n\t\t\t\t\teventResult[eventKey] = pathToSelector(\n\t\t\t\t\t\teventValue.length ? eventValue[0] : null,\n\t\t\t\t\t)\n\t\t\t\t} else {\n\t\t\t\t\teventResult[eventKey] = eventValue\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn eventResult\n\t\t} else if (value instanceof Node) {\n\t\t\tif (value instanceof HTMLElement) {\n\t\t\t\treturn value ? value.outerHTML : ''\n\t\t\t}\n\t\t\treturn value.nodeName\n\t\t} else if (value instanceof Error) {\n\t\t\treturn value.name + ': ' + value.message\n\t\t}\n\t\treturn value\n\t})\n\n\t/**\n\t * whether we should ignore obj's info and call toString() function instead\n\t */\n\tfunction shouldIgnore(_obj: object): boolean {\n\t\t// outof keys limit\n\t\tif (\n\t\t\tisObject(_obj) &&\n\t\t\tObject.keys(_obj).length > options.numOfKeysLimit\n\t\t) {\n\t\t\treturn true\n\t\t}\n\n\t\t// is function\n\t\tif (typeof _obj === 'function') {\n\t\t\treturn true\n\t\t}\n\n\t\t// if a non-user event with only the `isTrusted` key\n\t\t// We ignore this because some frameworks/library can output these non-stop.\n\t\t// There's no value in recording/showing these to the end user so we ignore.\n\t\tif (_obj instanceof Event && _obj.isTrusted === false) {\n\t\t\tconst eventKeys = Object.keys(_obj)\n\n\t\t\treturn eventKeys.length === 1\n\t\t}\n\n\t\t/**\n\t\t * judge object's depth to avoid browser's OOM\n\t\t *\n\t\t * issues: https://github.com/rrweb-io/rrweb/issues/653\n\t\t */\n\t\tif (isObject(_obj) && isObjTooDeep(_obj, options.depthOfLimit)) {\n\t\t\treturn true\n\t\t}\n\n\t\treturn false\n\t}\n\n\t/**\n\t * limit the toString() result according to option\n\t */\n\tfunction toString(_obj: object): string {\n\t\tlet str = _obj.toString()\n\t\tif (\n\t\t\toptions.stringLengthLimit &&\n\t\t\tstr.length > options.stringLengthLimit\n\t\t) {\n\t\t\tstr = `${str.slice(0, options.stringLengthLimit)}...`\n\t\t}\n\t\treturn str\n\t}\n}\n\nfunction supportsWebP(): boolean {\n\tvar elem = document.createElement('canvas')\n\tif (!!(elem.getContext && elem.getContext('2d'))) {\n\t\treturn elem.toDataURL('image/webp').indexOf('data:image/webp') == 0\n\t}\n\treturn false\n}\n\nexport function getDefaultDataURLOptions(): {\n\ttype: string\n\tquality: number\n} {\n\tif (supportsWebP()) {\n\t\treturn {\n\t\t\ttype: 'image/webp',\n\t\t\tquality: 0.9,\n\t\t}\n\t}\n\treturn {\n\t\ttype: 'image/jpeg',\n\t\tquality: 0.6,\n\t}\n}\n","(function(root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('stackframe', [], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.StackFrame = factory();\n    }\n}(this, function() {\n    'use strict';\n    function _isNumber(n) {\n        return !isNaN(parseFloat(n)) && isFinite(n);\n    }\n\n    function _capitalize(str) {\n        return str.charAt(0).toUpperCase() + str.substring(1);\n    }\n\n    function _getter(p) {\n        return function() {\n            return this[p];\n        };\n    }\n\n    var booleanProps = ['isConstructor', 'isEval', 'isNative', 'isToplevel'];\n    var numericProps = ['columnNumber', 'lineNumber'];\n    var stringProps = ['fileName', 'functionName', 'source'];\n    var arrayProps = ['args'];\n    var objectProps = ['evalOrigin'];\n\n    var props = booleanProps.concat(numericProps, stringProps, arrayProps, objectProps);\n\n    function StackFrame(obj) {\n        if (!obj) return;\n        for (var i = 0; i < props.length; i++) {\n            if (obj[props[i]] !== undefined) {\n                this['set' + _capitalize(props[i])](obj[props[i]]);\n            }\n        }\n    }\n\n    StackFrame.prototype = {\n        getArgs: function() {\n            return this.args;\n        },\n        setArgs: function(v) {\n            if (Object.prototype.toString.call(v) !== '[object Array]') {\n                throw new TypeError('Args must be an Array');\n            }\n            this.args = v;\n        },\n\n        getEvalOrigin: function() {\n            return this.evalOrigin;\n        },\n        setEvalOrigin: function(v) {\n            if (v instanceof StackFrame) {\n                this.evalOrigin = v;\n            } else if (v instanceof Object) {\n                this.evalOrigin = new StackFrame(v);\n            } else {\n                throw new TypeError('Eval Origin must be an Object or StackFrame');\n            }\n        },\n\n        toString: function() {\n            var fileName = this.getFileName() || '';\n            var lineNumber = this.getLineNumber() || '';\n            var columnNumber = this.getColumnNumber() || '';\n            var functionName = this.getFunctionName() || '';\n            if (this.getIsEval()) {\n                if (fileName) {\n                    return '[eval] (' + fileName + ':' + lineNumber + ':' + columnNumber + ')';\n                }\n                return '[eval]:' + lineNumber + ':' + columnNumber;\n            }\n            if (functionName) {\n                return functionName + ' (' + fileName + ':' + lineNumber + ':' + columnNumber + ')';\n            }\n            return fileName + ':' + lineNumber + ':' + columnNumber;\n        }\n    };\n\n    StackFrame.fromString = function StackFrame$$fromString(str) {\n        var argsStartIndex = str.indexOf('(');\n        var argsEndIndex = str.lastIndexOf(')');\n\n        var functionName = str.substring(0, argsStartIndex);\n        var args = str.substring(argsStartIndex + 1, argsEndIndex).split(',');\n        var locationString = str.substring(argsEndIndex + 1);\n\n        if (locationString.indexOf('@') === 0) {\n            var parts = /@(.+?)(?::(\\d+))?(?::(\\d+))?$/.exec(locationString, '');\n            var fileName = parts[1];\n            var lineNumber = parts[2];\n            var columnNumber = parts[3];\n        }\n\n        return new StackFrame({\n            functionName: functionName,\n            args: args || undefined,\n            fileName: fileName,\n            lineNumber: lineNumber || undefined,\n            columnNumber: columnNumber || undefined\n        });\n    };\n\n    for (var i = 0; i < booleanProps.length; i++) {\n        StackFrame.prototype['get' + _capitalize(booleanProps[i])] = _getter(booleanProps[i]);\n        StackFrame.prototype['set' + _capitalize(booleanProps[i])] = (function(p) {\n            return function(v) {\n                this[p] = Boolean(v);\n            };\n        })(booleanProps[i]);\n    }\n\n    for (var j = 0; j < numericProps.length; j++) {\n        StackFrame.prototype['get' + _capitalize(numericProps[j])] = _getter(numericProps[j]);\n        StackFrame.prototype['set' + _capitalize(numericProps[j])] = (function(p) {\n            return function(v) {\n                if (!_isNumber(v)) {\n                    throw new TypeError(p + ' must be a Number');\n                }\n                this[p] = Number(v);\n            };\n        })(numericProps[j]);\n    }\n\n    for (var k = 0; k < stringProps.length; k++) {\n        StackFrame.prototype['get' + _capitalize(stringProps[k])] = _getter(stringProps[k]);\n        StackFrame.prototype['set' + _capitalize(stringProps[k])] = (function(p) {\n            return function(v) {\n                this[p] = String(v);\n            };\n        })(stringProps[k]);\n    }\n\n    return StackFrame;\n}));\n","(function(root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('error-stack-parser', ['stackframe'], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('stackframe'));\n    } else {\n        root.ErrorStackParser = factory(root.StackFrame);\n    }\n}(this, function ErrorStackParser(StackFrame) {\n    'use strict';\n\n    var FIREFOX_SAFARI_STACK_REGEXP = /(^|@)\\S+:\\d+/;\n    var CHROME_IE_STACK_REGEXP = /^\\s*at .*(\\S+:\\d+|\\(native\\))/m;\n    var SAFARI_NATIVE_CODE_REGEXP = /^(eval@)?(\\[native code])?$/;\n\n    return {\n        /**\n         * Given an Error object, extract the most information from it.\n         *\n         * @param {Error} error object\n         * @return {Array} of StackFrames\n         */\n        parse: function ErrorStackParser$$parse(error) {\n            if (typeof error.stacktrace !== 'undefined' || typeof error['opera#sourceloc'] !== 'undefined') {\n                return this.parseOpera(error);\n            } else if (error.stack && error.stack.match(CHROME_IE_STACK_REGEXP)) {\n                return this.parseV8OrIE(error);\n            } else if (error.stack) {\n                return this.parseFFOrSafari(error);\n            } else {\n                throw new Error('Cannot parse given Error object');\n            }\n        },\n\n        // Separate line and column numbers from a string of the form: (URI:Line:Column)\n        extractLocation: function ErrorStackParser$$extractLocation(urlLike) {\n            // Fail-fast but return locations like \"(native)\"\n            if (urlLike.indexOf(':') === -1) {\n                return [urlLike];\n            }\n\n            var regExp = /(.+?)(?::(\\d+))?(?::(\\d+))?$/;\n            var parts = regExp.exec(urlLike.replace(/[()]/g, ''));\n            return [parts[1], parts[2] || undefined, parts[3] || undefined];\n        },\n\n        parseV8OrIE: function ErrorStackParser$$parseV8OrIE(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !!line.match(CHROME_IE_STACK_REGEXP);\n            }, this);\n\n            return filtered.map(function(line) {\n                if (line.indexOf('(eval ') > -1) {\n                    // Throw away eval information until we implement stacktrace.js/stackframe#8\n                    line = line.replace(/eval code/g, 'eval').replace(/(\\(eval at [^()]*)|(\\),.*$)/g, '');\n                }\n                var sanitizedLine = line.replace(/^\\s+/, '').replace(/\\(eval code/g, '(');\n\n                // capture and preseve the parenthesized location \"(/foo/my bar.js:12:87)\" in\n                // case it has spaces in it, as the string is split on \\s+ later on\n                var location = sanitizedLine.match(/ (\\((.+):(\\d+):(\\d+)\\)$)/);\n\n                // remove the parenthesized location from the line, if it was matched\n                sanitizedLine = location ? sanitizedLine.replace(location[0], '') : sanitizedLine;\n\n                var tokens = sanitizedLine.split(/\\s+/).slice(1);\n                // if a location was matched, pass it to extractLocation() otherwise pop the last token\n                var locationParts = this.extractLocation(location ? location[1] : tokens.pop());\n                var functionName = tokens.join(' ') || undefined;\n                var fileName = ['eval', '<anonymous>'].indexOf(locationParts[0]) > -1 ? undefined : locationParts[0];\n\n                return new StackFrame({\n                    functionName: functionName,\n                    fileName: fileName,\n                    lineNumber: locationParts[1],\n                    columnNumber: locationParts[2],\n                    source: line\n                });\n            }, this);\n        },\n\n        parseFFOrSafari: function ErrorStackParser$$parseFFOrSafari(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !line.match(SAFARI_NATIVE_CODE_REGEXP);\n            }, this);\n\n            return filtered.map(function(line) {\n                // Throw away eval information until we implement stacktrace.js/stackframe#8\n                if (line.indexOf(' > eval') > -1) {\n                    line = line.replace(/ line (\\d+)(?: > eval line \\d+)* > eval:\\d+:\\d+/g, ':$1');\n                }\n\n                if (line.indexOf('@') === -1 && line.indexOf(':') === -1) {\n                    // Safari eval frames only have function names and nothing else\n                    return new StackFrame({\n                        functionName: line\n                    });\n                } else {\n                    var functionNameRegex = /((.*\".+\"[^@]*)?[^@]*)(?:@)/;\n                    var matches = line.match(functionNameRegex);\n                    var functionName = matches && matches[1] ? matches[1] : undefined;\n                    var locationParts = this.extractLocation(line.replace(functionNameRegex, ''));\n\n                    return new StackFrame({\n                        functionName: functionName,\n                        fileName: locationParts[0],\n                        lineNumber: locationParts[1],\n                        columnNumber: locationParts[2],\n                        source: line\n                    });\n                }\n            }, this);\n        },\n\n        parseOpera: function ErrorStackParser$$parseOpera(e) {\n            if (!e.stacktrace || (e.message.indexOf('\\n') > -1 &&\n                e.message.split('\\n').length > e.stacktrace.split('\\n').length)) {\n                return this.parseOpera9(e);\n            } else if (!e.stack) {\n                return this.parseOpera10(e);\n            } else {\n                return this.parseOpera11(e);\n            }\n        },\n\n        parseOpera9: function ErrorStackParser$$parseOpera9(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)/i;\n            var lines = e.message.split('\\n');\n            var result = [];\n\n            for (var i = 2, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(new StackFrame({\n                        fileName: match[2],\n                        lineNumber: match[1],\n                        source: lines[i]\n                    }));\n                }\n            }\n\n            return result;\n        },\n\n        parseOpera10: function ErrorStackParser$$parseOpera10(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)(?:: In function (\\S+))?$/i;\n            var lines = e.stacktrace.split('\\n');\n            var result = [];\n\n            for (var i = 0, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(\n                        new StackFrame({\n                            functionName: match[3] || undefined,\n                            fileName: match[2],\n                            lineNumber: match[1],\n                            source: lines[i]\n                        })\n                    );\n                }\n            }\n\n            return result;\n        },\n\n        // Opera 10.65+ Error.stack very similar to FF/Safari\n        parseOpera11: function ErrorStackParser$$parseOpera11(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !!line.match(FIREFOX_SAFARI_STACK_REGEXP) && !line.match(/^Error created at/);\n            }, this);\n\n            return filtered.map(function(line) {\n                var tokens = line.split('@');\n                var locationParts = this.extractLocation(tokens.pop());\n                var functionCall = (tokens.shift() || '');\n                var functionName = functionCall\n                    .replace(/<anonymous function(: (\\w+))?>/, '$2')\n                    .replace(/\\([^)]*\\)/g, '') || undefined;\n                var argsRaw;\n                if (functionCall.match(/\\(([^)]*)\\)/)) {\n                    argsRaw = functionCall.replace(/^[^(]+\\(([^)]*)\\)$/, '$1');\n                }\n                var args = (argsRaw === undefined || argsRaw === '[arguments not available]') ?\n                    undefined : argsRaw.split(',');\n\n                return new StackFrame({\n                    functionName: functionName,\n                    args: args,\n                    fileName: locationParts[0],\n                    lineNumber: locationParts[1],\n                    columnNumber: locationParts[2],\n                    source: line\n                });\n            }, this);\n        }\n    };\n}));\n","import { ConsoleMessage } from '../types/shared-types'\nimport { ConsoleMethods } from '../types/client'\nimport { patch, stringify } from '../utils/utils'\nimport ErrorStackParser from 'error-stack-parser'\n\nexport type StringifyOptions = {\n\t// limit of string length\n\tstringLengthLimit?: number\n\t/**\n\t * limit of number of keys in an object\n\t * if an object contains more keys than this limit, we would call its toString function directly\n\t */\n\tnumOfKeysLimit: number\n\t/**\n\t * limit number of depth in an object\n\t * if an object is too deep, toString process may cause browser OOM\n\t */\n\tdepthOfLimit: number\n}\n\nexport type LogRecordOptions = {\n\tlevel: ConsoleMethods[]\n\tstringifyOptions: StringifyOptions\n\t/**\n\t * Set to try to serialize console object arguments into the message body.\n\t */\n\tserializeConsoleAttributes?: boolean\n\tlogger: Logger | 'console'\n}\n\nexport type Logger = {\n\tassert?: typeof console.assert\n\tclear?: typeof console.clear\n\tcount?: typeof console.count\n\tcountReset?: typeof console.countReset\n\tdebug?: typeof console.debug\n\tdir?: typeof console.dir\n\tdirxml?: typeof console.dirxml\n\terror?: typeof console.error\n\tgroup?: typeof console.group\n\tgroupCollapsed?: typeof console.groupCollapsed\n\tgroupEnd?: () => void\n\tinfo?: typeof console.info\n\tlog?: typeof console.log\n\ttable?: typeof console.table\n\ttime?: typeof console.time\n\ttimeEnd?: typeof console.timeEnd\n\ttimeLog?: typeof console.timeLog\n\ttrace?: typeof console.trace\n\twarn?: typeof console.warn\n}\n\nexport function ConsoleListener(\n\tcallback: (c: ConsoleMessage) => void,\n\tlogOptions: LogRecordOptions,\n) {\n\tconst loggerType = logOptions.logger\n\tif (!loggerType) {\n\t\treturn () => {}\n\t}\n\tlet logger: Logger\n\tif (typeof loggerType === 'string') {\n\t\tlogger = window[loggerType]\n\t} else {\n\t\tlogger = loggerType\n\t}\n\tconst cancelHandlers: (() => void)[] = []\n\n\t// add listener to thrown errors\n\tif (logOptions.level.includes('error')) {\n\t\tif (window) {\n\t\t\tconst errorHandler = (event: ErrorEvent) => {\n\t\t\t\tconst { message, error } = event\n\t\t\t\tlet trace: any[] = []\n\t\t\t\tif (error) {\n\t\t\t\t\ttrace = ErrorStackParser.parse(error)\n\t\t\t\t}\n\t\t\t\tconst payload = [\n\t\t\t\t\tstringify(message, logOptions.stringifyOptions),\n\t\t\t\t]\n\t\t\t\tcallback({\n\t\t\t\t\ttype: 'Error',\n\t\t\t\t\ttrace,\n\t\t\t\t\ttime: Date.now(),\n\t\t\t\t\tvalue: payload,\n\t\t\t\t})\n\t\t\t}\n\t\t\twindow.addEventListener('error', errorHandler)\n\t\t\tcancelHandlers.push(() => {\n\t\t\t\tif (window) window.removeEventListener('error', errorHandler)\n\t\t\t})\n\t\t}\n\t}\n\n\tfor (const levelType of logOptions.level) {\n\t\tcancelHandlers.push(replace(logger, levelType))\n\t}\n\treturn () => {\n\t\tcancelHandlers.forEach((h) => h())\n\t}\n\n\t/**\n\t * replace the original console function and record logs\n\t * @param logger the logger object such as Console\n\t * @param level the name of log function to be replaced\n\t */\n\tfunction replace(_logger: Logger, level: ConsoleMethods) {\n\t\tif (!_logger[level]) {\n\t\t\treturn () => {}\n\t\t}\n\t\t// replace the logger.{level}. return a restore function\n\t\treturn patch(_logger, level, (original) => {\n\t\t\treturn (...data: Array<any>) => {\n\t\t\t\t// @ts-expect-error\n\t\t\t\toriginal.apply(this, data)\n\t\t\t\ttry {\n\t\t\t\t\tconst trace = ErrorStackParser.parse(new Error())\n\t\t\t\t\tconst message = logOptions.serializeConsoleAttributes\n\t\t\t\t\t\t? data.map((o) =>\n\t\t\t\t\t\t\t\ttypeof o === 'object'\n\t\t\t\t\t\t\t\t\t? stringify(o, logOptions.stringifyOptions)\n\t\t\t\t\t\t\t\t\t: o,\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: data\n\t\t\t\t\t\t\t\t.filter((o) => typeof o !== 'object')\n\t\t\t\t\t\t\t\t.map((o) => `${o}`)\n\t\t\t\t\tcallback({\n\t\t\t\t\t\ttype: level,\n\t\t\t\t\t\ttrace: trace.slice(1),\n\t\t\t\t\t\tvalue: message,\n\t\t\t\t\t\tattributes: stringify(\n\t\t\t\t\t\t\tdata\n\t\t\t\t\t\t\t\t.filter((d) => typeof d === 'object')\n\t\t\t\t\t\t\t\t.reduce((a, b) => ({ ...a, ...b }), {}),\n\t\t\t\t\t\t\tlogOptions.stringifyOptions,\n\t\t\t\t\t\t),\n\t\t\t\t\t\ttime: Date.now(),\n\t\t\t\t\t})\n\t\t\t\t} catch (error) {\n\t\t\t\t\toriginal('highlight logger error:', error, ...data)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n}\n","exports = module.exports = stringify\nexports.getSerialize = serializer\n\nfunction stringify(obj, replacer, spaces, cycleReplacer) {\n  return JSON.stringify(obj, serializer(replacer, cycleReplacer), spaces)\n}\n\nfunction serializer(replacer, cycleReplacer) {\n  var stack = [], keys = []\n\n  if (cycleReplacer == null) cycleReplacer = function(key, value) {\n    if (stack[0] === value) return \"[Circular ~]\"\n    return \"[Circular ~.\" + keys.slice(0, stack.indexOf(value)).join(\".\") + \"]\"\n  }\n\n  return function(key, value) {\n    if (stack.length > 0) {\n      var thisPos = stack.indexOf(this)\n      ~thisPos ? stack.splice(thisPos + 1) : stack.push(this)\n      ~thisPos ? keys.splice(thisPos, Infinity, key) : keys.push(key)\n      if (~stack.indexOf(value)) value = cycleReplacer.call(this, key, value)\n    }\n    else stack.push(value)\n\n    return replacer == null ? value : replacer.call(this, key, value)\n  }\n}\n","import { ErrorMessage } from '../types/shared-types'\nimport stringify from 'json-stringify-safe'\nimport ErrorStackParser from 'error-stack-parser'\nimport { HighlightOptions } from '../types/types'\nimport { HighlightClassOptions } from '../index'\n\ninterface HighlightPromise<T> extends Promise<T> {\n\tpromiseCreationError: Error\n\tgetStack(): Error | undefined\n}\n\nfunction handleError(\n\tcallback: (e: ErrorMessage) => void,\n\tevent: any,\n\tsource: string | undefined,\n\terror?: Error,\n) {\n\tlet res: ErrorStackParser.StackFrame[] = []\n\ttry {\n\t\tres = ErrorStackParser.parse(error ?? event)\n\t} catch (e) {\n\t\tres = ErrorStackParser.parse(new Error())\n\t}\n\tlet payload: Object = {}\n\tif (event instanceof Error) {\n\t\tevent = event.message\n\t\tif (event.cause) {\n\t\t\tpayload = { 'exception.cause': event.cause }\n\t\t}\n\t}\n\tconst framesToUse = removeHighlightFrameIfExists(res)\n\tcallback({\n\t\tevent: stringify(event),\n\t\ttype: 'window.onerror',\n\t\turl: window.location.href,\n\t\tsource: source ?? '',\n\t\tlineNumber: framesToUse[0]?.lineNumber ? framesToUse[0]?.lineNumber : 0,\n\t\tcolumnNumber: framesToUse[0]?.columnNumber\n\t\t\t? framesToUse[0]?.columnNumber\n\t\t\t: 0,\n\t\tstackTrace: framesToUse,\n\t\ttimestamp: new Date().toISOString(),\n\t\tpayload: payload ? stringify(payload) : undefined,\n\t})\n}\n\nexport const ErrorListener = (\n\tcallback: (e: ErrorMessage) => void,\n\t{ enablePromisePatch }: { enablePromisePatch: boolean },\n) => {\n\tif (typeof window === 'undefined') return () => {}\n\n\tconst initialOnError = (window.onerror = (\n\t\tevent: any,\n\t\tsource: string | undefined,\n\t\tlineno: number | undefined,\n\t\tcolno: number | undefined,\n\t\terror: Error | undefined,\n\t): void => {\n\t\thandleError(callback, event, source, error)\n\t})\n\n\tconst initialOnUnhandledRejection = (window.onunhandledrejection = (\n\t\tevent: PromiseRejectionEvent,\n\t) => {\n\t\tif (event.reason) {\n\t\t\tconst hPromise = event.promise as HighlightPromise<any>\n\t\t\tif (hPromise.getStack) {\n\t\t\t\thandleError(\n\t\t\t\t\tcallback,\n\t\t\t\t\tevent.reason,\n\t\t\t\t\tevent.type,\n\t\t\t\t\thPromise.getStack(),\n\t\t\t\t)\n\t\t\t} else {\n\t\t\t\thandleError(callback, event.reason, event.type)\n\t\t\t}\n\t\t}\n\t})\n\n\tconst initialPromise = window.Promise\n\tconst highlightPromise = class Promise<T> extends initialPromise<T> {\n\t\tprivate readonly promiseCreationError: Error\n\n\t\tconstructor(\n\t\t\texecutor: (\n\t\t\t\tresolve: (value: T | PromiseLike<T>) => void,\n\t\t\t\treject: (reason?: Error) => void,\n\t\t\t) => void,\n\t\t) {\n\t\t\tsuper(executor)\n\t\t\tthis.promiseCreationError = new Error()\n\t\t}\n\n\t\tgetStack() {\n\t\t\treturn this.promiseCreationError\n\t\t}\n\n\t\tstatic shouldPatch() {\n\t\t\t// @ts-ignore\n\t\t\tconst zoneUndefined = typeof window.Zone === 'undefined'\n\t\t\treturn enablePromisePatch && zoneUndefined\n\t\t}\n\t}\n\tif (highlightPromise.shouldPatch()) {\n\t\twindow.Promise = highlightPromise\n\t}\n\treturn () => {\n\t\twindow.Promise = initialPromise\n\t\twindow.onunhandledrejection = initialOnUnhandledRejection\n\t\twindow.onerror = initialOnError\n\t}\n}\n\nconst removeHighlightFrameIfExists = (\n\tframes: ErrorStackParser.StackFrame[],\n): ErrorStackParser.StackFrame[] => {\n\tif (frames.length === 0) {\n\t\treturn frames\n\t}\n\n\tconst firstFrame = frames[0]\n\tif (\n\t\tfirstFrame.fileName?.includes('highlight.run') ||\n\t\tfirstFrame.fileName?.includes('highlight.io') ||\n\t\tfirstFrame.functionName === 'new highlightPromise'\n\t) {\n\t\treturn frames.slice(1)\n\t}\n\treturn frames\n}\n","import { RequestResponsePair } from '../listeners/network-listener/utils/models'\n\nexport const ALL_CONSOLE_METHODS = [\n\t'assert',\n\t'count',\n\t'countReset',\n\t'debug',\n\t'dir',\n\t'dirxml',\n\t'error',\n\t'group',\n\t'groupCollapsed',\n\t'groupEnd',\n\t'info',\n\t'log',\n\t'table',\n\t'time',\n\t'timeEnd',\n\t'timeLog',\n\t'trace',\n\t'warn',\n] as const\ntype ConsoleMethodsTuple = typeof ALL_CONSOLE_METHODS\nexport declare type ConsoleMethods = ConsoleMethodsTuple[number]\n\nexport declare type DebugOptions = {\n\tclientInteractions?: boolean\n\tdomRecording?: boolean\n}\n\nexport declare type NetworkRecordingOptions = {\n\t/**\n\t * Enables recording of network requests.\n\t * The data includes the URLs, the size of the request, and how long the request took.\n\t * @default true\n\t */\n\tenabled?: boolean\n\t/**\n\t * This enables recording XMLHttpRequest and Fetch headers and bodies.\n\t * @default false\n\t */\n\trecordHeadersAndBody?: boolean\n\t/**\n\t * This disables recording WebSocket events.\n\t * WebSocket events are recorded by default if recordHeadersAndBody is set.\n\t * @default false\n\t */\n\tdisableWebSocketEventRecordings?: boolean\n\t/**\n\t * Request and response headers where the value is not recorded.\n\t * The header value is replaced with '[REDACTED]'.\n\t * These headers are case-insensitive.\n\t * `recordHeadersAndBody` needs to be enabled.\n\t * This option will be ignored if `headerKeysToRecord` is set.\n\t * @example\n\t * networkHeadersToRedact: ['Secret-Header', 'Plain-Text-Password']\n\t */\n\tnetworkHeadersToRedact?: string[]\n\t/**\n\t * Specifies the keys for request/response JSON body that should not be recorded.\n\t * The body value is replaced with '[REDACTED]'.\n\t * These keys are case-insensitive.\n\t * `enabled` and `recordHeadersAndBody` need to be `true`. Otherwise this option will be ignored.\n\t * @example bodyKeysToRedact: ['secret-token', 'plain-text-password']\n\t * // Only `body.id` and `body.pageNumber` will be recorded.\n\t * body = {\n\t * 'id': '123',\n\t * 'pageNumber': '1',\n\t * 'secret-token': 'super-sensitive-value',\n\t * 'plain-text-password': 'password123',\n\t * }\n\t */\n\tnetworkBodyKeysToRedact?: string[]\n\t/**\n\t * URLs to not record headers and bodies for.\n\t * To disable recording headers and bodies for all URLs, set `recordHeadersAndBody` to `false`.\n\t * @default ['https://www.googleapis.com/identitytoolkit', 'https://securetoken.googleapis.com']\n\t */\n\turlBlocklist?: string[]\n\t/**\n\t * Specifies the keys for request/response headers to record.\n\t * This option will override `networkHeadersToRedact` if specified.\n\t * `enabled` and `recordHeadersAndBody` need to be `true`. Otherwise this option will be ignored.\n\t * @example headerKeysToRecord: ['id', 'pageNumber']\n\t * // Only `headers.id` and `headers.pageNumber` will be recorded.\n\t * headers = {\n\t * 'id': '123',\n\t * 'pageNumber': '1',\n\t * 'secret-token': 'super-sensitive-value',\n\t * 'plain-text-password': 'password123',\n\t * }\n\t */\n\theaderKeysToRecord?: string[]\n\t/**\n\t * Specifies the keys for request/response JSON body to record.\n\t * This option will override `networkBodyKeysToRedact` if specified.\n\t * `enabled` and `recordHeadersAndBody` need to be `true`. Otherwise this option will be ignored.\n\t * @example bodyKeysToRecord: ['id', 'pageNumber']\n\t * // Only `body.id` and `body.pageNumber` will be recorded.\n\t * body = {\n\t * 'id': '123',\n\t * 'pageNumber': '1',\n\t * 'secret-token': 'super-sensitive-value',\n\t * 'plain-text-password': 'password123',\n\t * }\n\t */\n\tbodyKeysToRecord?: string[]\n\t/**\n\t * Record frontend network request metrics that are sent to\n\t * the following list of domains. A domain substring match is used to\n\t * determine if a network request matches one of the following values.\n\t * @example destinationDomains: ['backend.example.com']\n\t * // if your frontend makes requests to `backend.example.com` that you would like to record\n\t */\n\tdestinationDomains?: string[]\n\t/**\n\t * Function to edit/remove data in request/response pairs or ignore the pair entirely.\n\t * @example\n\t * ```\n\t * requestResponseSanitizer: pair => {\n\t *   if (pair.request.url.toLowerCase().indexOf('ignore') !== -1) {\n\t *      // ignore the entire request/response pair (no network logs)\n\t *      return null\n\t *    }\n\t *\n\t *    if (pair.response.body.indexOf('secret') !== -1) {\n\t *        // remove the body in the response\n\t * \t\t\t\tdelete pair.response.body;\n\t *    }\n\t *\n\t *    return pair\n\t * }\n\t * ```\n\t *\n\t */\n\trequestResponseSanitizer?: (\n\t\tpair: RequestResponsePair,\n\t) => RequestResponsePair | null\n}\n\nexport declare type IntegrationOptions = {\n\tamplitude?: AmplitudeIntegrationOptions\n\tintercom?: IntercomIntegrationOptions\n\tmixpanel?: MixpanelIntegrationOptions\n}\n\nexport declare type SessionShortcutOptions = false | string\n\ntype DefaultIntegrationOptions = {\n\tdisabled?: boolean\n}\n\nexport declare interface MixpanelIntegrationOptions\n\textends DefaultIntegrationOptions {\n\tprojectToken?: string\n}\n\nexport declare interface AmplitudeIntegrationOptions\n\textends DefaultIntegrationOptions {\n\tapiKey?: string\n}\n\nexport declare interface IntercomIntegrationOptions\n\textends DefaultIntegrationOptions {}\n\nexport enum MetricName {\n\tDeviceMemory = 'DeviceMemory',\n\tViewportHeight = 'ViewportHeight',\n\tViewportWidth = 'ViewportWidth',\n\tScreenHeight = 'ScreenHeight',\n\tScreenWidth = 'ScreenWidth',\n\tViewportArea = 'ViewportArea',\n}\nexport enum MetricCategory {\n\tDevice = 'Device',\n\tWebVital = 'WebVital',\n\tPerformance = 'Performance',\n\tFrontend = 'Frontend',\n\tBackend = 'Backend',\n}\n","export const ERRORS_TO_IGNORE = [\n\t'[\"\\\\\"Script error.\\\\\"\"]' /** This is an error that happens from a script that is on a different origin than the origin that Highlight is running on. See: https://sentry.io/answers/script-error/*/,\n\t'\"Script error.\"' /** This is an error that happens from a script that is on a different origin than the origin that Highlight is running on. See: https://sentry.io/answers/script-error/*/,\n\t'[\"\\\\\"Load failed.\\\\\"\"]',\n\t'\"Load failed.\"',\n\t'[\"\\\\\"Network request failed.\\\\\"\"]',\n\t'\"Network request failed.\"',\n\t'[\"\\\\\"Document is not focused.\\\\\"\"]',\n\t'\"Document is not focused.\"',\n\t'[\"\\\\\"Failed to fetch\\\\\"\"]',\n\t'\"Failed to fetch\"',\n\t'[{\"isTrusted\":true}]' /** Cross-origin errors: https://stackoverflow.com/questions/44815172/log-shows-error-object-istrustedtrue-instead-of-actual-error-data */,\n\t'{\"isTrusted\":true}' /** Cross-origin errors: https://stackoverflow.com/questions/44815172/log-shows-error-object-istrustedtrue-instead-of-actual-error-data */,\n\t'[\"{}\"]',\n\t'\"{}\"',\n\t'[\"\"]',\n\t'\"\"',\n\t'[\"\\\\\"\\\\\"\"]',\n\t'\"\"',\n]\n\nexport const ERROR_PATTERNS_TO_IGNORE = [\n\t'websocket error',\n\t'\\\\\"ResizeObserver loop',\n]\n","import { Request, Response, Headers } from './models'\n\nexport const sanitizeResource = <T extends Request | Response>(\n\tresource: T,\n\theadersToRedact: string[],\n\theadersToRecord?: string[],\n): T => {\n\tconst newHeaders = sanitizeHeaders(\n\t\theadersToRedact,\n\t\tresource.headers,\n\t\theadersToRecord,\n\t)\n\n\treturn {\n\t\t...resource,\n\t\theaders: newHeaders,\n\t}\n}\n\nexport const sanitizeHeaders = (\n\theadersToRedact: string[],\n\theaders?: Headers,\n\theadersToRecord?: string[],\n) => {\n\tconst newHeaders = { ...headers }\n\n\t// `headersToRecord` overrides `headersToRedact`.\n\tif (headersToRecord) {\n\t\tObject.keys(newHeaders)?.forEach((header: string) => {\n\t\t\t// Only keep the keys that are specified in `headersToRecord`.\n\t\t\tif (![...headersToRecord].includes(header?.toLowerCase())) {\n\t\t\t\tnewHeaders[header] = '[REDACTED]'\n\t\t\t}\n\t\t})\n\n\t\treturn newHeaders\n\t}\n\n\tObject.keys(newHeaders)?.forEach((header: string) => {\n\t\t// Redact all the keys in `headersToRedact`.\n\t\tif (\n\t\t\t[...SENSITIVE_HEADERS, ...headersToRedact].includes(\n\t\t\t\theader?.toLowerCase(),\n\t\t\t)\n\t\t) {\n\t\t\tnewHeaders[header] = '[REDACTED]'\n\t\t}\n\t})\n\n\treturn newHeaders\n}\n\n/** These are known headers that are secrets. */\nconst SENSITIVE_HEADERS = [\n\t'authorization',\n\t'cookie',\n\t'proxy-authorization',\n\t'token',\n]\n\n/** Known URLs that contains secrets. */\nexport const DEFAULT_URL_BLOCKLIST = [\n\t'https://www.googleapis.com/identitytoolkit',\n\t'https://securetoken.googleapis.com',\n]\n","type Mode = 'localStorage' | 'sessionStorage'\n\nlet mode: Mode = 'localStorage'\n\nclass Storage {\n\tprivate storage: { [key: string]: string } = {}\n\tpublic getItem(key: string) {\n\t\treturn this.storage[key] ?? ''\n\t}\n\tpublic setItem(key: string, value: string) {\n\t\tthis.storage[key] = value\n\t}\n\tpublic removeItem(key: string) {\n\t\tdelete this.storage[key]\n\t}\n}\n\nlet globalStorage = new Storage()\n\nconst getPersistentStorage = () => {\n\ttry {\n\t\tswitch (mode) {\n\t\t\tcase 'localStorage':\n\t\t\t\treturn window.localStorage\n\t\t\tcase 'sessionStorage':\n\t\t\t\treturn window.sessionStorage\n\t\t}\n\t} catch (e) {\n\t\treturn globalStorage\n\t}\n}\n\nexport const setStorageMode = (m: Mode) => {\n\tmode = m\n}\n\nexport const getItem = (key: string) => {\n\treturn getPersistentStorage().getItem(key)\n}\n\nexport const setItem = (key: string, value: string) => {\n\treturn getPersistentStorage().setItem(key, value)\n}\n\nexport const removeItem = (key: string) => {\n\treturn getPersistentStorage().removeItem(key)\n}\n\nexport const monkeyPatchLocalStorage = (\n\tonSetItemHandler: ({\n\t\tkeyName,\n\t\tkeyValue,\n\t}: {\n\t\tkeyName: string\n\t\tkeyValue: string\n\t}) => void,\n) => {\n\tif (mode === 'sessionStorage') {\n\t\tconsole.warn(\n\t\t\t`highlight.io cannot use local storage; segment integration will not work`,\n\t\t)\n\t\treturn\n\t}\n\n\tconst originalSetItem = window.localStorage.setItem\n\twindow.localStorage.setItem = function () {\n\t\tconst [keyName, keyValue] = arguments as unknown as [\n\t\t\tkey: string,\n\t\t\tvalue: string,\n\t\t]\n\t\tonSetItemHandler({ keyName, keyValue })\n\t\toriginalSetItem.apply(this, [keyName, keyValue])\n\t}\n}\n","/**\n *  The amount of time to wait until sending the first payload.\n */\nexport const FIRST_SEND_FREQUENCY = 1000\n/**\n * The amount of time between sending the client-side payload to Highlight backend client.\n * In milliseconds.\n */\nexport const SEND_FREQUENCY = 1000 * 2\n\n/**\n * Maximum length of a session\n */\nexport const MAX_SESSION_LENGTH = 4 * 60 * 60 * 1000\n\n/**\n * The amount of time allowed after the last push before creating a new session.\n * In milliseconds.\n */\nexport const SESSION_PUSH_THRESHOLD = 15 * 60 * 1000\n\n/*\n * Don't take another full snapshot unless it's been at least\n * 4 minutes AND the cumulative payload size since the last\n * snapshot is > 10MB.\n */\nexport const SNAPSHOT_SETTINGS = {\n\tnormal: {\n\t\tbytes: 10e6,\n\t\ttime: 4 * 60 * 1000,\n\t},\n\tcanvas: {\n\t\tbytes: 16e6,\n\t\ttime: 5000,\n\t},\n} as const\n\n// Debounce duplicate visibility events\nexport const VISIBILITY_DEBOUNCE_MS = 100\n","import { SESSION_STORAGE_KEYS } from './sessionStorageKeys'\nimport { getItem, removeItem, setItem } from '../storage'\nimport { SESSION_PUSH_THRESHOLD } from '../../constants/sessions'\n\nexport type SessionData = {\n\tsessionSecureID: string\n\tprojectID: number\n\tsessionStartTime?: number\n\tlastPushTime?: number\n\tuserIdentifier?: string\n\tuserObject?: Object\n}\n\nexport const getPreviousSessionData = (): SessionData | undefined => {\n\tlet storedSessionData = JSON.parse(\n\t\tgetItem(SESSION_STORAGE_KEYS.SESSION_DATA) || '{}',\n\t)\n\tif (\n\t\tstoredSessionData &&\n\t\tstoredSessionData.lastPushTime &&\n\t\tDate.now() - storedSessionData.lastPushTime < SESSION_PUSH_THRESHOLD\n\t) {\n\t\treturn storedSessionData as SessionData\n\t}\n}\n\nexport const setSessionData = function (sessionData: SessionData | null) {\n\tif (sessionData === null) {\n\t\tremoveItem(SESSION_STORAGE_KEYS.SESSION_DATA)\n\t\t// preserve SESSION_STORAGE_KEYS.SESSION_SECURE_ID as that is used by network listeners\n\t\treturn\n\t}\n\tsetItem(SESSION_STORAGE_KEYS.SESSION_DATA, JSON.stringify(sessionData))\n\tsetSessionSecureID(sessionData.sessionSecureID)\n}\n\nexport const getSessionSecureID = function () {\n\treturn getItem(SESSION_STORAGE_KEYS.SESSION_SECURE_ID) ?? ''\n}\n\nexport const setSessionSecureID = function (sessionSecureID: string) {\n\treturn setItem(SESSION_STORAGE_KEYS.SESSION_SECURE_ID, sessionSecureID)\n}\n","import { RequestResponsePair } from './models'\nimport { sanitizeResource } from './network-sanitizer'\nimport { getSessionSecureID } from '../../../utils/sessionStorage/highlightSession'\n\nexport const HIGHLIGHT_REQUEST_HEADER = 'X-Highlight-Request'\n\nexport const normalizeUrl = (url: string) => {\n\tlet urlToMutate = url\n\t/**\n\t * Make sure URL includes the protocol and the host.\n\t * For Next.js API routes, the URL is only the pathname.\n\t * @example There's a Next.js API route called `/api/todo/create` on an app hosted at `https://todos.com`\n\t * The URL we get from the XHR/Fetch listener is `/api/todo/create`.\n\t * The Performance API's URL is `https://todos.com/api/todo/create`.\n\t * Because of this mismatch, we fail to match the request with the headers/payload.\n\t */\n\tif (!url.startsWith('https://') && !url.startsWith('http://')) {\n\t\turlToMutate = `${window.location.origin}${urlToMutate}`\n\t}\n\n\t// Remove trailing forward slashes\n\treturn urlToMutate.replace(/\\/+$/, '')\n}\n\ntype GroupedPerformanceTimings = {\n\txmlhttprequest: { [url: string]: PerformanceResourceTiming[] }\n\tothers: { [url: string]: PerformanceResourceTiming[] }\n\tfetch: { [url: string]: PerformanceResourceTiming[] }\n}\n\ntype PerformanceResourceTimingWithRequestResponsePair =\n\tPerformanceResourceTiming & {\n\t\trequestResponsePair: RequestResponsePair\n\t}\n\ntype SanitizeOptions = {\n\theadersToRedact: string[]\n\theadersToRecord?: string[]\n\trequestResponseSanitizer?: (\n\t\tpair: RequestResponsePair,\n\t) => RequestResponsePair | null\n}\n\nconst sanitizeRequestResponsePair = (\n\tpair: RequestResponsePair,\n\t{\n\t\theadersToRedact,\n\t\theadersToRecord,\n\t\trequestResponseSanitizer,\n\t}: SanitizeOptions,\n): RequestResponsePair | null => {\n\t// body keys are already be redacted at this point (see getBodyThatShouldBeRecorded)\n\tlet sanitizedPair: RequestResponsePair | null = pair\n\n\t// step 1: pass through user defined sanitizer\n\tif (requestResponseSanitizer) {\n\t\tlet stringifyRequestBody = true\n\t\ttry {\n\t\t\tsanitizedPair.request.body = JSON.parse(sanitizedPair.request.body)\n\t\t} catch (err) {\n\t\t\tstringifyRequestBody = false\n\t\t}\n\n\t\tlet stringifyResponseBody = true\n\t\ttry {\n\t\t\tsanitizedPair.response.body = JSON.parse(\n\t\t\t\tsanitizedPair.response.body,\n\t\t\t)\n\t\t} catch (err) {\n\t\t\tstringifyResponseBody = false\n\t\t}\n\n\t\ttry {\n\t\t\tsanitizedPair = requestResponseSanitizer(sanitizedPair)\n\t\t} catch (err) {\n\t\t} finally {\n\t\t\tstringifyRequestBody =\n\t\t\t\tstringifyRequestBody && !!sanitizedPair?.request?.body\n\t\t\tstringifyResponseBody =\n\t\t\t\tstringifyResponseBody && !!sanitizedPair?.response?.body\n\n\t\t\tif (stringifyRequestBody) {\n\t\t\t\tsanitizedPair!.request.body = JSON.stringify(\n\t\t\t\t\tsanitizedPair!.request.body,\n\t\t\t\t)\n\t\t\t}\n\t\t\tif (stringifyResponseBody) {\n\t\t\t\tsanitizedPair!.response.body = JSON.stringify(\n\t\t\t\t\tsanitizedPair!.response.body,\n\t\t\t\t)\n\t\t\t}\n\t\t}\n\n\t\tif (!sanitizedPair) {\n\t\t\treturn null\n\t\t}\n\t}\n\n\t// step 2: redact any specified headers\n\tconst { request, response, ...rest } = sanitizedPair\n\n\treturn {\n\t\trequest: sanitizeResource(request, headersToRedact, headersToRecord),\n\t\tresponse: sanitizeResource(response, headersToRedact, headersToRecord),\n\t\t...rest,\n\t}\n}\n\nexport const matchPerformanceTimingsWithRequestResponsePair = (\n\tperformanceTimings: PerformanceResourceTiming[],\n\trequestResponsePairs: RequestResponsePair[],\n\ttype: 'xmlhttprequest' | 'fetch',\n\tsanitizeOptions: SanitizeOptions,\n) => {\n\t// Request response pairs are sorted by end time; sort performance timings the same way\n\tperformanceTimings.sort((a, b) => a.responseEnd - b.responseEnd)\n\n\tconst initialGroupedPerformanceTimings: GroupedPerformanceTimings = {\n\t\txmlhttprequest: {},\n\t\tothers: {},\n\t\tfetch: {},\n\t}\n\n\tconst groupedPerformanceTimings: {\n\t\t[type: string]: { [url: string]: any[] }\n\t} = performanceTimings.reduce((previous, performanceTiming) => {\n\t\tconst url = normalizeUrl(performanceTiming.name)\n\t\tif (performanceTiming.initiatorType === type) {\n\t\t\tprevious[type][url] = [\n\t\t\t\t...(previous[type][url] || []),\n\t\t\t\tperformanceTiming,\n\t\t\t]\n\t\t} else {\n\t\t\tprevious.others[url] = [\n\t\t\t\t...(previous.others[url] || []),\n\t\t\t\tperformanceTiming,\n\t\t\t]\n\t\t}\n\t\treturn previous\n\t}, initialGroupedPerformanceTimings)\n\n\tlet groupedRequestResponsePairs: {\n\t\t[url: string]: RequestResponsePair[]\n\t} = {}\n\tgroupedRequestResponsePairs = requestResponsePairs.reduce(\n\t\t(previous, requestResponsePair) => {\n\t\t\tconst url = normalizeUrl(requestResponsePair.request.url)\n\t\t\tprevious[url] = [...(previous[url] || []), requestResponsePair]\n\t\t\treturn previous\n\t\t},\n\t\tgroupedRequestResponsePairs,\n\t)\n\n\tfor (let url in groupedPerformanceTimings[type]) {\n\t\tconst performanceTimingsForUrl = groupedPerformanceTimings[type][url]\n\t\tconst requestResponsePairsForUrl = groupedRequestResponsePairs[url]\n\t\tif (!requestResponsePairsForUrl) {\n\t\t\tcontinue\n\t\t}\n\t\t/**\n\t\t * We offset the starting because performanceTimings starts recording\n\t\t * immediately and requestResponsePairs only start recording when Highlight\n\t\t * is loaded. Because of this requestResponsePairs will not always have the\n\t\t * first few requests made when a page loads.\n\t\t */\n\t\tconst offset = Math.max(\n\t\t\tperformanceTimingsForUrl.length - requestResponsePairsForUrl.length,\n\t\t\t0,\n\t\t)\n\t\tfor (let i = offset; i < performanceTimingsForUrl.length; i++) {\n\t\t\tif (performanceTimingsForUrl[i]) {\n\t\t\t\tperformanceTimingsForUrl[i].requestResponsePair =\n\t\t\t\t\trequestResponsePairsForUrl[i - offset]\n\t\t\t}\n\t\t}\n\t}\n\n\tlet result: PerformanceResourceTimingWithRequestResponsePair[] = []\n\tfor (let type in groupedPerformanceTimings) {\n\t\tfor (let url in groupedPerformanceTimings[type]) {\n\t\t\tresult = result.concat(groupedPerformanceTimings[type][url])\n\t\t}\n\t}\n\n\treturn result\n\t\t.sort((a, b) => a.fetchStart - b.fetchStart)\n\t\t.reduce(\n\t\t\t(\n\t\t\t\tresources: PerformanceResourceTimingWithRequestResponsePair[],\n\t\t\t\tperformanceTiming: PerformanceResourceTimingWithRequestResponsePair,\n\t\t\t) => {\n\t\t\t\tlet requestResponsePair: RequestResponsePair | null =\n\t\t\t\t\tperformanceTiming.requestResponsePair\n\n\t\t\t\tif (requestResponsePair) {\n\t\t\t\t\trequestResponsePair = sanitizeRequestResponsePair(\n\t\t\t\t\t\tperformanceTiming.requestResponsePair,\n\t\t\t\t\t\tsanitizeOptions,\n\t\t\t\t\t)\n\n\t\t\t\t\t// ignore request if it was filtered out by the user defined sanitizer\n\t\t\t\t\tif (!requestResponsePair) {\n\t\t\t\t\t\treturn resources\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tperformanceTiming.toJSON = function () {\n\t\t\t\t\t// offset by `window.performance.timeOrigin` to get absolute timestamps\n\t\t\t\t\tconst o = window.performance.timeOrigin\n\t\t\t\t\treturn {\n\t\t\t\t\t\tinitiatorType: this.initiatorType,\n\t\t\t\t\t\tstartTimeAbs: o + this.startTime,\n\t\t\t\t\t\tconnectStartAbs: o + this.connectStart,\n\t\t\t\t\t\tconnectEndAbs: o + this.connectEnd,\n\t\t\t\t\t\tdomainLookupStartAbs: o + this.domainLookupStart,\n\t\t\t\t\t\tdomainLookupEndAbs: o + this.domainLookupEnd,\n\t\t\t\t\t\tfetchStartAbs: o + this.fetchStart,\n\t\t\t\t\t\tredirectStartAbs: o + this.redirectStart,\n\t\t\t\t\t\tredirectEndAbs: o + this.redirectEnd,\n\t\t\t\t\t\trequestStartAbs: o + this.requestStart,\n\t\t\t\t\t\tresponseStartAbs: o + this.responseStart,\n\t\t\t\t\t\tresponseEndAbs: o + this.responseEnd,\n\t\t\t\t\t\tsecureConnectionStartAbs:\n\t\t\t\t\t\t\to + this.secureConnectionStart,\n\t\t\t\t\t\tworkerStartAbs: o + this.workerStart,\n\t\t\t\t\t\tname: this.name,\n\t\t\t\t\t\ttransferSize: this.transferSize,\n\t\t\t\t\t\tencodedBodySize: this.encodedBodySize,\n\t\t\t\t\t\tdecodedBodySize: this.decodedBodySize,\n\t\t\t\t\t\tnextHopProtocol: this.nextHopProtocol,\n\t\t\t\t\t\trequestResponsePairs: requestResponsePair,\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresources.push(performanceTiming)\n\t\t\t\treturn resources\n\t\t\t},\n\t\t\t[],\n\t\t)\n}\n\n/**\n * Returns true if the name is a Highlight network resource.\n * This is used to filter out Highlight requests/responses from showing up on end application's network resources.\n */\nconst isHighlightNetworkResourceFilter = (name: string, backendUrl: string) =>\n\tname\n\t\t.toLocaleLowerCase()\n\t\t.includes(\n\t\t\timport.meta.env.REACT_APP_PUBLIC_GRAPH_URI ?? 'highlight.io',\n\t\t) ||\n\tname.toLocaleLowerCase().includes('highlight.io') ||\n\tname.toLocaleLowerCase().includes(backendUrl)\n\nexport const shouldNetworkRequestBeRecorded = (\n\turl: string,\n\thighlightBackendUrl: string,\n\ttracingOrigins?: boolean | (string | RegExp)[],\n) => {\n\treturn (\n\t\t!isHighlightNetworkResourceFilter(url, highlightBackendUrl) ||\n\t\tshouldNetworkRequestBeTraced(url, tracingOrigins)\n\t)\n}\n\nexport const shouldNetworkRequestBeTraced = (\n\turl: string,\n\ttracingOrigins?: boolean | (string | RegExp)[],\n) => {\n\tlet patterns: (string | RegExp)[] = []\n\tif (tracingOrigins === true) {\n\t\tpatterns = ['localhost', /^\\//]\n\t\tif (window?.location?.host) {\n\t\t\tpatterns.push(window.location.host)\n\t\t}\n\t} else if (tracingOrigins instanceof Array) {\n\t\tpatterns = tracingOrigins\n\t}\n\n\tlet result = false\n\tpatterns.forEach((pattern) => {\n\t\tif (url.match(pattern)) {\n\t\t\tresult = true\n\t\t}\n\t})\n\treturn result\n}\n\nfunction makeId(length: number) {\n\tvar result = ''\n\tvar characters =\n\t\t'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'\n\tvar charactersLength = characters.length\n\tfor (var i = 0; i < length; i++) {\n\t\tresult += characters.charAt(\n\t\t\tMath.floor(Math.random() * charactersLength),\n\t\t)\n\t}\n\treturn result\n}\n\nexport const createNetworkRequestId = () => {\n\t// Long enough to avoid collisions, not long enough to be unguessable\n\treturn [getSessionSecureID(), makeId(10)]\n}\n\nexport const getHighlightRequestHeader = (\n\tsessionSecureID: string,\n\trequestId: string,\n) => {\n\treturn sessionSecureID + '/' + requestId\n}\n","import stringify from 'json-stringify-safe'\n\nimport { NetworkListenerCallback } from '../network-listener'\nimport { Headers, Request, RequestResponsePair, Response } from './models'\nimport {\n\tcreateNetworkRequestId,\n\tgetHighlightRequestHeader,\n\tHIGHLIGHT_REQUEST_HEADER,\n\tshouldNetworkRequestBeRecorded,\n\tshouldNetworkRequestBeTraced,\n} from './utils'\n\nexport interface BrowserXHR extends XMLHttpRequest {\n\t_method: string\n\t_url: string\n\t_requestHeaders: Headers\n\t_responseSize?: number\n\t_shouldRecordHeaderAndBody: boolean\n\t_body?: any\n}\n\n/**\n * Listens to all XMLHttpRequests made.\n */\nexport const XHRListener = (\n\tcallback: NetworkListenerCallback,\n\tbackendUrl: string,\n\ttracingOrigins: boolean | (string | RegExp)[],\n\turlBlocklist: string[],\n\tbodyKeysToRedact?: string[],\n\tbodyKeysToRecord?: string[],\n) => {\n\tconst XHR = XMLHttpRequest.prototype\n\n\tconst originalOpen = XHR.open\n\tconst originalSend = XHR.send\n\tconst originalSetRequestHeader = XHR.setRequestHeader\n\n\t/**\n\t * When a request gets initiated, store metadata for that specific request.\n\t */\n\tXHR.open = function (this: BrowserXHR, method: string, url: string | URL) {\n\t\tif (typeof url === 'string') {\n\t\t\tthis._url = url\n\t\t} else {\n\t\t\tthis._url = url.toString()\n\t\t}\n\t\tthis._method = method\n\t\tthis._requestHeaders = {}\n\t\tthis._shouldRecordHeaderAndBody = !urlBlocklist.some((blockedUrl) =>\n\t\t\tthis._url.toLowerCase().includes(blockedUrl),\n\t\t)\n\n\t\t// @ts-expect-error\n\t\treturn originalOpen.apply(this, arguments)\n\t}\n\n\tXHR.setRequestHeader = function (\n\t\tthis: BrowserXHR,\n\t\theader: string,\n\t\tvalue: string,\n\t) {\n\t\tthis._requestHeaders[header] = value\n\n\t\t// @ts-expect-error\n\t\treturn originalSetRequestHeader.apply(this, arguments)\n\t}\n\n\tXHR.send = function (this: BrowserXHR, postData: any) {\n\t\tif (\n\t\t\t!shouldNetworkRequestBeRecorded(\n\t\t\t\tthis._url,\n\t\t\t\tbackendUrl,\n\t\t\t\ttracingOrigins,\n\t\t\t)\n\t\t) {\n\t\t\t// @ts-expect-error\n\t\t\treturn originalSend.apply(this, arguments)\n\t\t}\n\n\t\tconst [sessionSecureID, requestId] = createNetworkRequestId()\n\t\tif (shouldNetworkRequestBeTraced(this._url, tracingOrigins)) {\n\t\t\tthis.setRequestHeader(\n\t\t\t\tHIGHLIGHT_REQUEST_HEADER,\n\t\t\t\tgetHighlightRequestHeader(sessionSecureID, requestId),\n\t\t\t)\n\t\t}\n\n\t\tconst shouldRecordHeaderAndBody = this._shouldRecordHeaderAndBody\n\t\tconst requestModel: Request = {\n\t\t\tsessionSecureID,\n\t\t\tid: requestId,\n\t\t\turl: this._url,\n\t\t\tverb: this._method,\n\t\t\theaders: shouldRecordHeaderAndBody ? this._requestHeaders : {},\n\t\t\tbody: undefined,\n\t\t}\n\n\t\tif (shouldRecordHeaderAndBody) {\n\t\t\tif (postData) {\n\t\t\t\tconst bodyData = getBodyData(postData, requestModel.url)\n\t\t\t\tif (bodyData) {\n\t\t\t\t\tthis._body = bodyData\n\t\t\t\t\trequestModel['body'] = getBodyThatShouldBeRecorded(\n\t\t\t\t\t\tbodyData,\n\t\t\t\t\t\tbodyKeysToRedact,\n\t\t\t\t\t\tbodyKeysToRecord,\n\t\t\t\t\t\trequestModel.headers,\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// The load event for XMLHttpRequest is fired when a request completes successfully.\n\t\tthis.addEventListener('load', async function () {\n\t\t\tconst responseModel: Response = {\n\t\t\t\tstatus: this.status,\n\t\t\t\theaders: {},\n\t\t\t\tbody: undefined,\n\t\t\t}\n\n\t\t\tif (shouldRecordHeaderAndBody) {\n\t\t\t\tconst responseHeaders = this.getAllResponseHeaders()\n\t\t\t\t// Convert the header string into an array\n\t\t\t\t// of individual headers\n\t\t\t\tconst normalizedResponseHeaders = responseHeaders\n\t\t\t\t\t.trim()\n\t\t\t\t\t.split(/[\\r\\n]+/)\n\n\t\t\t\t// Create a map of header names to values\n\t\t\t\tconst headerMap: { [key: string]: any } = {}\n\t\t\t\tnormalizedResponseHeaders.forEach(function (line) {\n\t\t\t\t\tconst parts = line.split(': ')\n\t\t\t\t\tconst header = parts.shift() as string\n\t\t\t\t\theaderMap[header] = parts.join(': ')\n\t\t\t\t})\n\t\t\t\tresponseModel.headers = headerMap\n\n\t\t\t\tif (postData) {\n\t\t\t\t\tconst bodyData = getBodyData(postData, requestModel.url)\n\t\t\t\t\tif (bodyData) {\n\t\t\t\t\t\trequestModel['body'] = getBodyThatShouldBeRecorded(\n\t\t\t\t\t\t\tbodyData,\n\t\t\t\t\t\t\tbodyKeysToRedact,\n\t\t\t\t\t\t\tbodyKeysToRecord,\n\t\t\t\t\t\t\tresponseModel.headers,\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this.responseType === '' || this.responseType === 'text') {\n\t\t\t\t\tresponseModel['body'] = getBodyThatShouldBeRecorded(\n\t\t\t\t\t\tthis.responseText,\n\t\t\t\t\t\tbodyKeysToRedact,\n\t\t\t\t\t\tbodyKeysToRecord,\n\t\t\t\t\t\tresponseModel.headers,\n\t\t\t\t\t)\n\t\t\t\t\t// Each character is 8 bytes, total size is number of characters multiplied by 8.\n\t\t\t\t\tresponseModel['size'] = this.responseText.length * 8\n\t\t\t\t} else if (this.responseType === 'blob') {\n\t\t\t\t\tif (this.response instanceof Blob) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst response = await this.response.text()\n\n\t\t\t\t\t\t\tresponseModel['body'] = getBodyThatShouldBeRecorded(\n\t\t\t\t\t\t\t\tresponse,\n\t\t\t\t\t\t\t\tbodyKeysToRedact,\n\t\t\t\t\t\t\t\tbodyKeysToRecord,\n\t\t\t\t\t\t\t\tresponseModel.headers,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\tresponseModel['size'] = this.response.size\n\t\t\t\t\t\t} catch {}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tresponseModel['body'] = getBodyThatShouldBeRecorded(\n\t\t\t\t\t\t\tthis.response,\n\t\t\t\t\t\t\tbodyKeysToRedact,\n\t\t\t\t\t\t\tbodyKeysToRecord,\n\t\t\t\t\t\t\tresponseModel.headers,\n\t\t\t\t\t\t)\n\t\t\t\t\t} catch {}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst event: RequestResponsePair = {\n\t\t\t\trequest: requestModel,\n\t\t\t\tresponse: responseModel,\n\t\t\t\turlBlocked: !shouldRecordHeaderAndBody,\n\t\t\t}\n\n\t\t\tcallback(event)\n\t\t})\n\n\t\t/**\n\t\t * The error event happens when a network request fails. A 4xx or 5xx\n\t\t * response will not trigger this, those will still trigger a load event.\n\t\t * An error is if the request is blocked, some scenarios:\n\t\t * 1. The request is blocked by an extension\n\t\t * 2. The request is blocked by the DevTools\n\t\t * 3. The client is offline\n\t\t */\n\t\tthis.addEventListener('error', async function () {\n\t\t\tconst responseModel: Response = {\n\t\t\t\tstatus: this.status,\n\t\t\t\theaders: undefined,\n\t\t\t\tbody: undefined,\n\t\t\t}\n\n\t\t\tconst event: RequestResponsePair = {\n\t\t\t\trequest: requestModel,\n\t\t\t\tresponse: responseModel,\n\t\t\t\turlBlocked: false,\n\t\t\t}\n\n\t\t\tcallback(event)\n\t\t})\n\n\t\t// @ts-expect-error\n\t\treturn originalSend.apply(this, arguments)\n\t}\n\n\treturn () => {\n\t\tXHR.open = originalOpen\n\t\tXHR.send = originalSend\n\t\tXHR.setRequestHeader = originalSetRequestHeader\n\t}\n}\n\nconst getBodyData = (postData: any, url: string | undefined) => {\n\tif (typeof postData === 'string') {\n\t\t// TODO: This should be removed when we move recording logic from client to firstload.\n\t\t// This is only for development purposes. We don't want to send the body of pushPayload requests because it'll end up being recursive.\n\t\tif (\n\t\t\t!(\n\t\t\t\t(url?.includes('localhost') ||\n\t\t\t\t\turl?.includes('highlight.run')) &&\n\t\t\t\tpostData.includes('pushPayload')\n\t\t\t)\n\t\t) {\n\t\t\treturn postData\n\t\t}\n\t} else if (\n\t\ttypeof postData === 'object' ||\n\t\ttypeof postData === 'number' ||\n\t\ttypeof postData === 'boolean'\n\t) {\n\t\treturn stringify(postData)\n\t}\n\n\treturn null\n}\n\nconst DEFAULT_BODY_LIMIT = 64 * 1024 // KB\nconst BODY_SIZE_LIMITS = {\n\t'application/json': 64 * 1024 * 1024, // MB\n\t'text/plain': 64 * 1024 * 1024, // MB\n} as const\n\nexport const getBodyThatShouldBeRecorded = (\n\tbodyData: any,\n\tbodyKeysToRedact?: string[],\n\tbodyKeysToRecord?: string[],\n\theaders?: Headers | { [key: string]: string },\n) => {\n\tlet bodyLimit: number = DEFAULT_BODY_LIMIT\n\tif (headers) {\n\t\tlet contentType: string = ''\n\t\tif (typeof headers['get'] === 'function') {\n\t\t\tcontentType = headers.get('content-type') ?? ''\n\t\t} else {\n\t\t\tcontentType = headers['content-type'] ?? ''\n\t\t}\n\t\ttry {\n\t\t\tcontentType = contentType.split(';')[0]\n\t\t} catch {}\n\t\tbodyLimit =\n\t\t\tBODY_SIZE_LIMITS[contentType as keyof typeof BODY_SIZE_LIMITS] ??\n\t\t\tDEFAULT_BODY_LIMIT\n\t}\n\n\tif (bodyData) {\n\t\tif (bodyKeysToRedact) {\n\t\t\ttry {\n\t\t\t\tconst json = JSON.parse(bodyData)\n\n\t\t\t\tif (Array.isArray(json)) {\n\t\t\t\t\tjson.forEach((element) => {\n\t\t\t\t\t\tObject.keys(element).forEach((key) => {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tbodyKeysToRedact.includes(\n\t\t\t\t\t\t\t\t\tkey.toLocaleLowerCase(),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\telement[key] = '[REDACTED]'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tObject.keys(json).forEach((key) => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tbodyKeysToRedact.includes(key.toLocaleLowerCase())\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tjson[key] = '[REDACTED]'\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tbodyData = JSON.stringify(json)\n\t\t\t} catch {}\n\t\t}\n\n\t\tif (bodyKeysToRecord) {\n\t\t\ttry {\n\t\t\t\tconst json = JSON.parse(bodyData)\n\n\t\t\t\tObject.keys(json).forEach((key) => {\n\t\t\t\t\tif (!bodyKeysToRecord.includes(key.toLocaleLowerCase())) {\n\t\t\t\t\t\tjson[key] = '[REDACTED]'\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tbodyData = JSON.stringify(json)\n\t\t\t} catch {}\n\t\t}\n\t}\n\n\ttry {\n\t\tbodyData = bodyData.slice(0, bodyLimit)\n\t} catch {}\n\n\treturn bodyData\n}\n","import {\n\tHIGHLIGHT_REQUEST_HEADER,\n\tcreateNetworkRequestId,\n\tgetHighlightRequestHeader,\n\tshouldNetworkRequestBeRecorded,\n\tshouldNetworkRequestBeTraced,\n} from './utils'\nimport {\n\tRequest as HighlightRequest,\n\tResponse as HighlightResponse,\n\tRequestResponsePair,\n} from './models'\n\nimport { NetworkListenerCallback } from '../network-listener'\nimport { getBodyThatShouldBeRecorded } from './xhr-listener'\n\nexport interface HighlightFetchWindow extends WindowOrWorkerGlobalScope {\n\t_originalFetch: WindowOrWorkerGlobalScope['fetch']\n\t_highlightFetchPatch: WindowOrWorkerGlobalScope['fetch']\n\t_fetchProxy: WindowOrWorkerGlobalScope['fetch']\n}\n\ndeclare var window: HighlightFetchWindow & Window\n\nexport const FetchListener = (\n\tcallback: NetworkListenerCallback,\n\tbackendUrl: string,\n\ttracingOrigins: boolean | (string | RegExp)[],\n\turlBlocklist: string[],\n\tbodyKeysToRedact?: string[],\n\tbodyKeysToRecord?: string[],\n) => {\n\tconst originalFetch = window._fetchProxy\n\n\twindow._fetchProxy = function (input, init) {\n\t\tconst { method, url } = getFetchRequestProperties(input, init)\n\t\tif (!shouldNetworkRequestBeRecorded(url, backendUrl, tracingOrigins)) {\n\t\t\treturn originalFetch.call(this, input, init)\n\t\t}\n\n\t\tconst [sessionSecureID, requestId] = createNetworkRequestId()\n\t\tif (shouldNetworkRequestBeTraced(url, tracingOrigins)) {\n\t\t\tinit = init || {}\n\t\t\t// Pre-existing headers could be one of three different formats; this reads all of them.\n\t\t\tlet headers = new Headers(init.headers)\n\n\t\t\tif (input instanceof Request) {\n\t\t\t\t;[...input.headers].forEach(([key, value]) =>\n\t\t\t\t\theaders.set(key, value),\n\t\t\t\t)\n\t\t\t}\n\n\t\t\theaders.set(\n\t\t\t\tHIGHLIGHT_REQUEST_HEADER,\n\t\t\t\tgetHighlightRequestHeader(sessionSecureID, requestId),\n\t\t\t)\n\n\t\t\tinit.headers = Object.fromEntries(headers.entries())\n\t\t}\n\n\t\tconst request: HighlightRequest = {\n\t\t\tsessionSecureID,\n\t\t\tid: requestId,\n\t\t\theaders: {},\n\t\t\tbody: undefined,\n\t\t\turl,\n\t\t\tverb: method,\n\t\t}\n\t\tconst shouldRecordHeaderAndBody = !urlBlocklist.some((blockedUrl) =>\n\t\t\turl.toLowerCase().includes(blockedUrl),\n\t\t)\n\t\tif (shouldRecordHeaderAndBody) {\n\t\t\trequest.headers = Object.fromEntries(\n\t\t\t\tnew Headers(init?.headers).entries(),\n\t\t\t)\n\t\t\trequest.body = getBodyThatShouldBeRecorded(\n\t\t\t\tinit?.body,\n\t\t\t\tbodyKeysToRedact,\n\t\t\t\tbodyKeysToRecord,\n\t\t\t\tinit?.headers,\n\t\t\t)\n\t\t}\n\n\t\tlet responsePromise = originalFetch.call(this, input, init)\n\t\tlogRequest(\n\t\t\tresponsePromise,\n\t\t\trequest,\n\t\t\tcallback,\n\t\t\tshouldRecordHeaderAndBody,\n\t\t\tbodyKeysToRedact,\n\t\t\tbodyKeysToRecord,\n\t\t)\n\t\treturn responsePromise\n\t}\n\n\treturn () => {\n\t\twindow._fetchProxy = originalFetch\n\t}\n}\n\nexport const getFetchRequestProperties = (\n\tinput: RequestInfo | URL,\n\tinit?: RequestInit,\n) => {\n\tconst method =\n\t\t(init && init.method) ||\n\t\t(typeof input === 'object' && 'method' in input && input.method) ||\n\t\t'GET'\n\tlet url: string\n\tif (typeof input === 'object') {\n\t\tif ('url' in input && input.url) {\n\t\t\turl = input.url\n\t\t} else {\n\t\t\turl = input.toString()\n\t\t}\n\t} else {\n\t\turl = input\n\t}\n\n\treturn {\n\t\tmethod,\n\t\turl,\n\t}\n}\n\n/** Logs the Fetch request once it resolves. */\nconst logRequest = (\n\tresponsePromise: Promise<Response>,\n\trequestPayload: HighlightRequest,\n\tcallback: NetworkListenerCallback,\n\tshouldRecordHeaderAndBody: boolean,\n\tbodyKeysToRedact?: string[],\n\tbodyKeysToRecord?: string[],\n) => {\n\tconst onPromiseResolveHandler = async (response: Response | Error) => {\n\t\tlet responsePayload: HighlightResponse = {\n\t\t\tbody: undefined,\n\t\t\theaders: undefined,\n\t\t\tstatus: 0,\n\t\t\tsize: 0,\n\t\t}\n\t\tlet requestHandled = false\n\t\tlet urlBlocked = !shouldRecordHeaderAndBody\n\n\t\tif ('stack' in response || response instanceof Error) {\n\t\t\tresponsePayload = {\n\t\t\t\t...responsePayload,\n\t\t\t\tbody: response.message,\n\t\t\t\tstatus: 0,\n\t\t\t\tsize: undefined,\n\t\t\t}\n\n\t\t\trequestHandled = true\n\t\t} else if ('status' in response) {\n\t\t\tresponsePayload = {\n\t\t\t\t...responsePayload,\n\t\t\t\tstatus: response.status,\n\t\t\t}\n\n\t\t\tif (shouldRecordHeaderAndBody) {\n\t\t\t\tresponsePayload.body = await getResponseBody(\n\t\t\t\t\tresponse,\n\t\t\t\t\tbodyKeysToRecord,\n\t\t\t\t\tbodyKeysToRedact,\n\t\t\t\t)\n\t\t\t\t// response.headers must be used as an iterable via `.entries()` to get headers\n\t\t\t\tresponsePayload.headers = Object.fromEntries(\n\t\t\t\t\tresponse.headers.entries(),\n\t\t\t\t)\n\t\t\t\tresponsePayload.size = responsePayload.body.length * 8\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tresponse.type === 'opaque' ||\n\t\t\t\tresponse.type === 'opaqueredirect'\n\t\t\t) {\n\t\t\t\turlBlocked = true\n\t\t\t\tresponsePayload = {\n\t\t\t\t\t...responsePayload,\n\t\t\t\t\tbody: 'CORS blocked request',\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trequestHandled = true\n\t\t}\n\n\t\tif (requestHandled) {\n\t\t\tconst event: RequestResponsePair = {\n\t\t\t\trequest: requestPayload,\n\t\t\t\tresponse: responsePayload,\n\t\t\t\turlBlocked,\n\t\t\t}\n\n\t\t\tcallback(event)\n\t\t}\n\t}\n\t// Swallow any error thrown by responsePromise\n\tresponsePromise.then(onPromiseResolveHandler).catch(() => {})\n}\n\nexport const getResponseBody = async (\n\tresponse: Response,\n\tbodyKeysToRecord: string[] | undefined,\n\tbodyKeysToRedact: string[] | undefined,\n) => {\n\tlet text: string\n\ttry {\n\t\t/**\n\t\t * We are using the TextDecoder because it supports a larger number of use cases.\n\t\t * Using just `response.text()` sometimes causes the body to fail due to the request being aborted.\n\t\t * https://stackoverflow.com/questions/41946457/getting-text-from-fetch-response-object\n\t\t */\n\t\tconst clone = response.clone()\n\t\tconst body = clone.body\n\t\tif (body) {\n\t\t\tlet reader = body.getReader()\n\t\t\tlet utf8Decoder = new TextDecoder()\n\t\t\tlet nextChunk\n\n\t\t\tlet result = ''\n\n\t\t\twhile (!(nextChunk = await reader.read()).done) {\n\t\t\t\tlet partialData = nextChunk.value\n\t\t\t\tresult += utf8Decoder.decode(partialData)\n\t\t\t}\n\t\t\ttext = result\n\t\t\ttext = getBodyThatShouldBeRecorded(\n\t\t\t\ttext,\n\t\t\t\tbodyKeysToRedact,\n\t\t\t\tbodyKeysToRecord,\n\t\t\t\tresponse.headers,\n\t\t\t)\n\t\t} else {\n\t\t\ttext = ''\n\t\t}\n\t} catch (e) {\n\t\ttext = `Unable to clone response: ${e as string}`\n\t}\n\n\treturn text\n}\n","import { WebSocketEvent, WebSocketRequest } from '../utils/models'\n\nexport type WebSocketRequestListenerCallback = (event: WebSocketRequest) => void\n\nexport type WebSocketEventListenerCallback = (event: WebSocketEvent) => void\n\nexport type HighlightWebSocketWindow = Window & {\n\t/**\n\t * Callback for web socket open and close events that are displayed in the network requests\n\t */\n\t_highlightWebSocketRequestCallback: WebSocketRequestListenerCallback\n\t/**\n\t * Callback for web socket message and error events that are displayed under the websocket requests\n\t */\n\t_highlightWebSocketEventCallback: WebSocketEventListenerCallback\n\tWebSocket: any\n}\n\ndeclare var window: HighlightWebSocketWindow\n\nconst WebSocketListener = (\n\trequestCallback: WebSocketRequestListenerCallback,\n\teventCallback: WebSocketEventListenerCallback,\n\turlBlocklist: string[],\n) => {\n\tconst initialHighlightWebSocketRequestCallback =\n\t\twindow._highlightWebSocketRequestCallback\n\twindow._highlightWebSocketRequestCallback = requestCallback\n\n\tconst initialHighlightWebSocketEventCallback =\n\t\twindow._highlightWebSocketEventCallback\n\twindow._highlightWebSocketEventCallback = (eventData: WebSocketEvent) => {\n\t\tconst { message, size, ...visibleEventData } = eventData\n\t\tconst blockedUrl = urlBlocklist.some((blockedUrl) =>\n\t\t\teventData.name.toLowerCase().includes(blockedUrl),\n\t\t)\n\n\t\tconst redactedEventData = blockedUrl ? visibleEventData : eventData\n\n\t\teventCallback(redactedEventData)\n\t}\n\n\treturn () => {\n\t\twindow._highlightWebSocketRequestCallback =\n\t\t\tinitialHighlightWebSocketRequestCallback\n\t\twindow._highlightWebSocketEventCallback =\n\t\t\tinitialHighlightWebSocketEventCallback\n\t}\n}\n\nexport { WebSocketListener }\n","import { NetworkRecordingOptions } from '../../types/client'\nimport { FetchListener } from './utils/fetch-listener'\nimport { RequestResponsePair } from './utils/models'\nimport { XHRListener } from './utils/xhr-listener'\nimport {\n\tWebSocketEventListenerCallback,\n\tWebSocketListener,\n\tWebSocketRequestListenerCallback,\n} from './utils/web-socket-listener'\n\nexport type NetworkListenerCallback = (\n\trequestResponsePair: RequestResponsePair,\n) => void\n\ntype NetworkListenerArguments = {\n\txhrCallback: NetworkListenerCallback\n\tfetchCallback: NetworkListenerCallback\n\twebSocketRequestCallback: WebSocketRequestListenerCallback\n\twebSocketEventCallback: WebSocketEventListenerCallback\n\tdisableWebSocketRecording: boolean\n\tbodyKeysToRedact: string[]\n\tbackendUrl: string\n\ttracingOrigins: boolean | (string | RegExp)[]\n\turlBlocklist: string[]\n\tsessionSecureID: string\n} & Pick<NetworkRecordingOptions, 'bodyKeysToRecord'>\n\nexport const NetworkListener = ({\n\txhrCallback,\n\tfetchCallback,\n\twebSocketRequestCallback,\n\twebSocketEventCallback,\n\tdisableWebSocketRecording,\n\tbodyKeysToRedact,\n\tbackendUrl,\n\ttracingOrigins,\n\turlBlocklist,\n\tsessionSecureID,\n\tbodyKeysToRecord,\n}: NetworkListenerArguments) => {\n\tconst removeXHRListener = XHRListener(\n\t\txhrCallback,\n\t\tbackendUrl,\n\t\ttracingOrigins,\n\t\turlBlocklist,\n\t\tbodyKeysToRedact,\n\t\tbodyKeysToRecord,\n\t)\n\tconst removeFetchListener = FetchListener(\n\t\tfetchCallback,\n\t\tbackendUrl,\n\t\ttracingOrigins,\n\t\turlBlocklist,\n\t\tbodyKeysToRedact,\n\t\tbodyKeysToRecord,\n\t)\n\n\tconst removeWebSocketListener = !disableWebSocketRecording\n\t\t? WebSocketListener(\n\t\t\t\twebSocketRequestCallback,\n\t\t\t\twebSocketEventCallback,\n\t\t\t\turlBlocklist,\n\t\t  )\n\t\t: () => {}\n\n\treturn () => {\n\t\tremoveXHRListener()\n\t\tremoveFetchListener()\n\t\tremoveWebSocketListener()\n\t}\n}\n","import { ConsoleListener } from './console-listener'\nimport { ErrorListener } from './error-listener'\n\nimport { ConsoleMessage, ErrorMessage } from '../types/shared-types'\nimport { ALL_CONSOLE_METHODS, ConsoleMethods } from '../types/client'\nimport { ERRORS_TO_IGNORE, ERROR_PATTERNS_TO_IGNORE } from '../constants/errors'\nimport { HighlightClassOptions } from '../index'\nimport stringify from 'json-stringify-safe'\nimport { DEFAULT_URL_BLOCKLIST } from './network-listener/utils/network-sanitizer'\nimport {\n\tRequestResponsePair,\n\tWebSocketEvent,\n\tWebSocketRequest,\n} from './network-listener/utils/models'\nimport { NetworkListener } from './network-listener/network-listener'\nimport {\n\tmatchPerformanceTimingsWithRequestResponsePair,\n\tshouldNetworkRequestBeRecorded,\n} from './network-listener/utils/utils'\n\n// Note: This class is used by both firstload and client. When constructed in client, it will match the current\n// codebase. When constructed in firstload, it will match the codebase at the time the npm package was published.\nexport class FirstLoadListeners {\n\tdisableConsoleRecording: boolean\n\treportConsoleErrors: boolean\n\tenablePromisePatch: boolean\n\tconsoleMethodsToRecord: ConsoleMethods[]\n\tlisteners: (() => void)[]\n\terrors: ErrorMessage[]\n\tmessages: ConsoleMessage[]\n\t// The properties below were added in 4.0.0 (Feb 2022), and are patched in by client via setupNetworkListeners()\n\toptions: HighlightClassOptions\n\thasNetworkRecording: boolean | undefined = true\n\t_backendUrl!: string\n\tdisableNetworkRecording!: boolean\n\tenableRecordingNetworkContents!: boolean\n\txhrNetworkContents!: RequestResponsePair[]\n\tfetchNetworkContents!: RequestResponsePair[]\n\tdisableRecordingWebSocketContents!: boolean\n\twebSocketNetworkContents!: WebSocketRequest[] | undefined\n\twebSocketEventContents!: WebSocketEvent[]\n\ttracingOrigins!: boolean | (string | RegExp)[]\n\tnetworkHeadersToRedact!: string[]\n\tnetworkBodyKeysToRedact: string[] | undefined\n\tnetworkBodyKeysToRecord: string[] | undefined\n\tnetworkHeaderKeysToRecord: string[] | undefined\n\tlastNetworkRequestTimestamp: number\n\turlBlocklist!: string[]\n\trequestResponseSanitizer?: (\n\t\tpair: RequestResponsePair,\n\t) => RequestResponsePair | null\n\n\tconstructor(options: HighlightClassOptions) {\n\t\tthis.options = options\n\t\tthis.disableConsoleRecording = !!options.disableConsoleRecording\n\t\tthis.reportConsoleErrors = options.reportConsoleErrors ?? false\n\t\tthis.enablePromisePatch = options.enablePromisePatch ?? true\n\t\tthis.consoleMethodsToRecord = options.consoleMethodsToRecord || [\n\t\t\t...ALL_CONSOLE_METHODS,\n\t\t]\n\t\tthis.listeners = []\n\t\tthis.errors = []\n\t\tthis.messages = []\n\t\tthis.lastNetworkRequestTimestamp = 0\n\t}\n\n\tisListening() {\n\t\treturn this.listeners.length > 0\n\t}\n\n\tstartListening() {\n\t\tif (this.isListening()) return\n\t\tconst highlightThis = this\n\t\tif (!this.disableConsoleRecording) {\n\t\t\tthis.listeners.push(\n\t\t\t\tConsoleListener(\n\t\t\t\t\t(c: ConsoleMessage) => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tthis.reportConsoleErrors &&\n\t\t\t\t\t\t\t(c.type === 'Error' || c.type === 'error') &&\n\t\t\t\t\t\t\tc.value &&\n\t\t\t\t\t\t\tc.trace\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tconst errorValue = stringify(c.value)\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tERRORS_TO_IGNORE.includes(errorValue) ||\n\t\t\t\t\t\t\t\tERROR_PATTERNS_TO_IGNORE.some((pattern) =>\n\t\t\t\t\t\t\t\t\terrorValue.includes(pattern),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\thighlightThis.errors.push({\n\t\t\t\t\t\t\t\tevent: errorValue,\n\t\t\t\t\t\t\t\ttype: 'console.error',\n\t\t\t\t\t\t\t\turl: window.location.href,\n\t\t\t\t\t\t\t\tsource: c.trace[0]?.fileName\n\t\t\t\t\t\t\t\t\t? c.trace[0].fileName\n\t\t\t\t\t\t\t\t\t: '',\n\t\t\t\t\t\t\t\tlineNumber: c.trace[0]?.lineNumber\n\t\t\t\t\t\t\t\t\t? c.trace[0].lineNumber\n\t\t\t\t\t\t\t\t\t: 0,\n\t\t\t\t\t\t\t\tcolumnNumber: c.trace[0]?.columnNumber\n\t\t\t\t\t\t\t\t\t? c.trace[0].columnNumber\n\t\t\t\t\t\t\t\t\t: 0,\n\t\t\t\t\t\t\t\tstackTrace: c.trace,\n\t\t\t\t\t\t\t\ttimestamp: new Date().toISOString(),\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\thighlightThis.messages.push(c)\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlevel: this.consoleMethodsToRecord,\n\t\t\t\t\t\tlogger: 'console',\n\t\t\t\t\t\tstringifyOptions: {\n\t\t\t\t\t\t\tdepthOfLimit: 10,\n\t\t\t\t\t\t\tnumOfKeysLimit: 100,\n\t\t\t\t\t\t\tstringLengthLimit: 1000,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t)\n\t\t}\n\t\tthis.listeners.push(\n\t\t\tErrorListener(\n\t\t\t\t(e: ErrorMessage) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tERRORS_TO_IGNORE.includes(e.event) ||\n\t\t\t\t\t\tERROR_PATTERNS_TO_IGNORE.some((pattern) =>\n\t\t\t\t\t\t\te.event.includes(pattern),\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\thighlightThis.errors.push(e)\n\t\t\t\t},\n\t\t\t\t{ enablePromisePatch: this.enablePromisePatch },\n\t\t\t),\n\t\t)\n\t\tif (this.options.enableOtelTracing) {\n\t\t\timport('@highlight-run/client/src/otel').then(({ shutdown }) => {\n\t\t\t\tthis.listeners.push(shutdown)\n\t\t\t})\n\t\t}\n\t\tFirstLoadListeners.setupNetworkListener(this, this.options)\n\t}\n\n\tstopListening() {\n\t\tthis.listeners.forEach((stop: () => void) => stop())\n\t\tthis.listeners = []\n\t}\n\n\t// We define this as a static method because versions earlier than 4.0.0 (Feb 2022) don't have this code.\n\t// For those versions, calling this from client will monkey-patch the network listeners onto the old FirstLoadListener object.\n\tstatic setupNetworkListener(\n\t\tsThis: FirstLoadListeners,\n\t\toptions: HighlightClassOptions,\n\t): void {\n\t\tsThis._backendUrl =\n\t\t\toptions?.backendUrl ||\n\t\t\timport.meta.env.REACT_APP_PUBLIC_GRAPH_URI ||\n\t\t\t'https://pub.highlight.run'\n\n\t\tsThis.xhrNetworkContents = []\n\t\tsThis.fetchNetworkContents = []\n\t\tsThis.webSocketNetworkContents = []\n\t\tsThis.webSocketEventContents = []\n\t\tsThis.networkHeadersToRedact = []\n\t\tsThis.urlBlocklist = []\n\t\tsThis.tracingOrigins = options.tracingOrigins || []\n\n\t\t// Old versions of `firstload` use `disableNetworkRecording`. We fork here to ensure backwards compatibility.\n\t\tif (options?.disableNetworkRecording !== undefined) {\n\t\t\tsThis.disableNetworkRecording = options?.disableNetworkRecording\n\t\t\tsThis.enableRecordingNetworkContents = false\n\t\t\tsThis.disableRecordingWebSocketContents = true\n\t\t\tsThis.networkHeadersToRedact = []\n\t\t\tsThis.networkBodyKeysToRedact = []\n\t\t\tsThis.urlBlocklist = []\n\t\t\tsThis.networkBodyKeysToRecord = []\n\t\t\tsThis.networkBodyKeysToRecord = []\n\t\t} else if (typeof options?.networkRecording === 'boolean') {\n\t\t\tsThis.disableNetworkRecording = !options.networkRecording\n\t\t\tsThis.enableRecordingNetworkContents = false\n\t\t\tsThis.disableRecordingWebSocketContents = true\n\t\t\tsThis.networkHeadersToRedact = []\n\t\t\tsThis.networkBodyKeysToRedact = []\n\t\t\tsThis.urlBlocklist = []\n\t\t} else {\n\t\t\tif (options.networkRecording?.enabled !== undefined) {\n\t\t\t\tsThis.disableNetworkRecording =\n\t\t\t\t\t!options.networkRecording.enabled\n\t\t\t} else {\n\t\t\t\tsThis.disableNetworkRecording = false\n\t\t\t}\n\t\t\tsThis.enableRecordingNetworkContents =\n\t\t\t\toptions.networkRecording?.recordHeadersAndBody || false\n\t\t\tsThis.disableRecordingWebSocketContents =\n\t\t\t\toptions.networkRecording?.disableWebSocketEventRecordings ||\n\t\t\t\tfalse\n\t\t\tsThis.networkHeadersToRedact =\n\t\t\t\toptions.networkRecording?.networkHeadersToRedact?.map(\n\t\t\t\t\t(header) => header.toLowerCase(),\n\t\t\t\t) || []\n\t\t\tsThis.networkBodyKeysToRedact =\n\t\t\t\toptions.networkRecording?.networkBodyKeysToRedact?.map(\n\t\t\t\t\t(bodyKey) => bodyKey.toLowerCase(),\n\t\t\t\t) || []\n\t\t\tsThis.urlBlocklist =\n\t\t\t\toptions.networkRecording?.urlBlocklist?.map((url) =>\n\t\t\t\t\turl.toLowerCase(),\n\t\t\t\t) || []\n\t\t\tsThis.urlBlocklist = [\n\t\t\t\t...sThis.urlBlocklist,\n\t\t\t\t...DEFAULT_URL_BLOCKLIST,\n\t\t\t]\n\n\t\t\tsThis.requestResponseSanitizer =\n\t\t\t\toptions.networkRecording?.requestResponseSanitizer\n\n\t\t\tsThis.networkHeaderKeysToRecord =\n\t\t\t\toptions.networkRecording?.headerKeysToRecord\n\t\t\t// `headerKeysToRecord` override `networkHeadersToRedact`.\n\t\t\tif (sThis.networkHeaderKeysToRecord) {\n\t\t\t\tsThis.networkHeadersToRedact = []\n\t\t\t\tsThis.networkHeaderKeysToRecord =\n\t\t\t\t\tsThis.networkHeaderKeysToRecord.map((key) =>\n\t\t\t\t\t\tkey.toLocaleLowerCase(),\n\t\t\t\t\t)\n\t\t\t}\n\n\t\t\tsThis.networkBodyKeysToRecord =\n\t\t\t\toptions.networkRecording?.bodyKeysToRecord\n\t\t\t// `bodyKeysToRecord` override `networkBodyKeysToRedact`.\n\t\t\tif (sThis.networkBodyKeysToRecord) {\n\t\t\t\tsThis.networkBodyKeysToRedact = []\n\t\t\t\tsThis.networkBodyKeysToRecord =\n\t\t\t\t\tsThis.networkBodyKeysToRecord.map((key) =>\n\t\t\t\t\t\tkey.toLocaleLowerCase(),\n\t\t\t\t\t)\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\t!sThis.disableNetworkRecording &&\n\t\t\tsThis.enableRecordingNetworkContents\n\t\t) {\n\t\t\tsThis.listeners.push(\n\t\t\t\tNetworkListener({\n\t\t\t\t\txhrCallback: (requestResponsePair) => {\n\t\t\t\t\t\tsThis.xhrNetworkContents.push(requestResponsePair)\n\t\t\t\t\t},\n\t\t\t\t\tfetchCallback: (requestResponsePair) => {\n\t\t\t\t\t\tsThis.fetchNetworkContents.push(requestResponsePair)\n\t\t\t\t\t},\n\t\t\t\t\twebSocketRequestCallback: (event) => {\n\t\t\t\t\t\tif (sThis.webSocketNetworkContents) {\n\t\t\t\t\t\t\tsThis.webSocketNetworkContents.push(event)\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\twebSocketEventCallback: (event) => {\n\t\t\t\t\t\tsThis.webSocketEventContents.push(event)\n\t\t\t\t\t},\n\t\t\t\t\tdisableWebSocketRecording:\n\t\t\t\t\t\tsThis.disableRecordingWebSocketContents,\n\t\t\t\t\tbodyKeysToRedact: sThis.networkBodyKeysToRedact,\n\t\t\t\t\tbackendUrl: sThis._backendUrl,\n\t\t\t\t\ttracingOrigins: sThis.tracingOrigins,\n\t\t\t\t\turlBlocklist: sThis.urlBlocklist,\n\t\t\t\t\tsessionSecureID: options.sessionSecureID,\n\t\t\t\t\tbodyKeysToRecord: sThis.networkBodyKeysToRecord,\n\t\t\t\t}),\n\t\t\t)\n\t\t}\n\t}\n\n\tstatic getRecordedNetworkResources(\n\t\tsThis: FirstLoadListeners,\n\t\trecordingStartTime: number,\n\t): Array<PerformanceResourceTiming | WebSocketRequest> {\n\t\tlet httpResources: Array<PerformanceResourceTiming> = []\n\t\tlet webSocketResources: Array<WebSocketRequest> = []\n\n\t\tif (!sThis.disableNetworkRecording) {\n\t\t\tconst documentTimeOrigin = window?.performance?.timeOrigin || 0\n\t\t\t// get all resources that don't include 'api.highlight.run'\n\t\t\thttpResources = performance.getEntriesByType(\n\t\t\t\t'resource',\n\t\t\t) as PerformanceResourceTiming[]\n\n\t\t\t// Subtract session start time from performance.timeOrigin\n\t\t\t// Subtract diff to the times to do the offsets\n\t\t\tconst offset = (recordingStartTime - documentTimeOrigin) * 2\n\n\t\t\thttpResources = httpResources\n\t\t\t\t.filter((r) => {\n\t\t\t\t\tif (r.responseEnd < sThis.lastNetworkRequestTimestamp) {\n\t\t\t\t\t\treturn false\n\t\t\t\t\t}\n\n\t\t\t\t\treturn shouldNetworkRequestBeRecorded(\n\t\t\t\t\t\tr.name,\n\t\t\t\t\t\tsThis._backendUrl,\n\t\t\t\t\t\tsThis.tracingOrigins,\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t\t.map((resource) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...resource.toJSON(),\n\t\t\t\t\t\toffsetStartTime: resource.startTime - offset,\n\t\t\t\t\t\toffsetResponseEnd: resource.responseEnd - offset,\n\t\t\t\t\t\toffsetFetchStart: resource.fetchStart - offset,\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\tsThis.lastNetworkRequestTimestamp =\n\t\t\t\thttpResources.at(-1)?.responseEnd ||\n\t\t\t\tsThis.lastNetworkRequestTimestamp\n\n\t\t\tif (sThis.enableRecordingNetworkContents) {\n\t\t\t\tconst sanitizeOptions = {\n\t\t\t\t\theadersToRedact: sThis.networkHeadersToRedact,\n\t\t\t\t\theadersToRecord: sThis.networkHeaderKeysToRecord,\n\t\t\t\t\trequestResponseSanitizer: sThis.requestResponseSanitizer,\n\t\t\t\t}\n\n\t\t\t\thttpResources = matchPerformanceTimingsWithRequestResponsePair(\n\t\t\t\t\thttpResources,\n\t\t\t\t\tsThis.xhrNetworkContents,\n\t\t\t\t\t'xmlhttprequest',\n\t\t\t\t\tsanitizeOptions,\n\t\t\t\t)\n\t\t\t\thttpResources = matchPerformanceTimingsWithRequestResponsePair(\n\t\t\t\t\thttpResources,\n\t\t\t\t\tsThis.fetchNetworkContents,\n\t\t\t\t\t'fetch',\n\t\t\t\t\tsanitizeOptions,\n\t\t\t\t)\n\t\t\t}\n\t\t}\n\n\t\tif (!sThis.disableRecordingWebSocketContents) {\n\t\t\twebSocketResources = sThis.webSocketNetworkContents || []\n\t\t}\n\n\t\treturn [...httpResources, ...webSocketResources]\n\t}\n\n\tstatic getRecordedWebSocketEvents(\n\t\tsThis: FirstLoadListeners,\n\t): Array<WebSocketEvent> {\n\t\tlet webSocketEvents: Array<WebSocketEvent> = []\n\n\t\tif (\n\t\t\t!sThis.disableNetworkRecording &&\n\t\t\t!sThis.disableRecordingWebSocketContents\n\t\t) {\n\t\t\twebSocketEvents = sThis.webSocketEventContents\n\t\t}\n\n\t\treturn webSocketEvents\n\t}\n\n\tstatic clearRecordedNetworkResources(sThis: FirstLoadListeners): void {\n\t\tif (!sThis.disableNetworkRecording) {\n\t\t\tsThis.xhrNetworkContents = []\n\t\t\tsThis.fetchNetworkContents = []\n\t\t\tsThis.webSocketNetworkContents = []\n\t\t\tsThis.webSocketEventContents = []\n\t\t\tperformance.clearResourceTimings()\n\t\t}\n\t}\n}\n","export const GenerateSecureID = (): string => {\n\tconst ID_LENGTH = 28\n\tconst CHARACTER_SET =\n\t\t'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\n\tvar secureID = ''\n\n\tconst hasCrypto =\n\t\ttypeof window !== 'undefined' && window.crypto?.getRandomValues\n\tconst cryptoRandom = new Uint32Array(ID_LENGTH)\n\tif (hasCrypto) {\n\t\twindow.crypto.getRandomValues(cryptoRandom)\n\t}\n\n\tfor (let i = 0; i < ID_LENGTH; i++) {\n\t\tif (hasCrypto) {\n\t\t\tsecureID += CHARACTER_SET.charAt(\n\t\t\t\tcryptoRandom[i] % CHARACTER_SET.length,\n\t\t\t)\n\t\t} else {\n\t\t\tsecureID += CHARACTER_SET.charAt(\n\t\t\t\tMath.floor(Math.random() * CHARACTER_SET.length),\n\t\t\t)\n\t\t}\n\t}\n\n\treturn secureID\n}\n","import type { HighlightPublicInterface } from '@highlight-run/client/src/types/types'\n\ninterface SegmentContext {\n\tpayload: any\n\tnext: any\n\tintegrations?: any\n}\n\nexport const HighlightSegmentMiddleware = ({\n\tnext,\n\tpayload,\n}: SegmentContext) => {\n\tif (\n\t\ttypeof window !== 'undefined' &&\n\t\ttypeof document !== 'undefined' &&\n\t\t'H' in window\n\t) {\n\t\tif (payload.obj.type === 'track') {\n\t\t\tconst trackEventName = payload.obj.event\n\t\t\tconst trackEventProperties = payload.obj.properties\n\t\t\twindow.H.track(trackEventName, trackEventProperties)\n\t\t} else if (payload.obj.type === 'identify') {\n\t\t\tconst identifier = payload.obj.userId\n\t\t\t// only send identify call if segment identify was called\n\t\t\t// with a user ID, since highlight identify requires a user ID.\n\t\t\tif (identifier?.length) {\n\t\t\t\tconst identifyMetadata = payload.obj.traits\n\t\t\t\twindow.H.identify(identifier, identifyMetadata)\n\t\t\t}\n\t\t}\n\t}\n\n\tnext(payload)\n}\n\ninterface HighlightWindow extends Window {\n\tH: HighlightPublicInterface\n}\n\ndeclare var window: HighlightWindow\n","/*\nGiven a `BrowserWindow`, sets up event listeners for Highlight.\n */\nexport default function configureElectronHighlight(window: any) {\n\tif (window.on && window.webContents?.send) {\n\t\twindow.on('focus', () => {\n\t\t\twindow.webContents.send('highlight.run', { visible: true })\n\t\t})\n\n\t\twindow.on('blur', () => {\n\t\t\twindow.webContents.send('highlight.run', { visible: false })\n\t\t})\n\n\t\twindow.on('close', () => {\n\t\t\twindow.webContents.send('highlight.run', { visible: false })\n\t\t})\n\t}\n}\n","export default \"9.1.0\"","import type { HighlightFetchWindow } from '@highlight-run/client/src/listeners/network-listener/utils/fetch-listener'\nimport type { HighlightPublicInterface } from '@highlight-run/client/src/types/types'\n\ntype HighlightWindow = Window & {\n\tH: HighlightPublicInterface\n} & HighlightFetchWindow\n\ndeclare var window: HighlightWindow\n\nexport const initializeFetchListener = () => {\n\tif (typeof window !== 'undefined') {\n\t\t// avoid initializing fetch listener more than once.\n\t\tif (typeof window._highlightFetchPatch !== 'undefined') {\n\t\t\treturn\n\t\t}\n\t\twindow._originalFetch = window.fetch\n\t\twindow._fetchProxy = (\n\t\t\tinput: RequestInfo,\n\t\t\tinit: RequestInit | undefined,\n\t\t) => {\n\t\t\treturn window._originalFetch(input, init)\n\t\t}\n\n\t\twindow._highlightFetchPatch = (\n\t\t\tinput: RequestInfo,\n\t\t\tinit: RequestInit | undefined,\n\t\t) => {\n\t\t\treturn window._fetchProxy.call(window || global, input, init)\n\t\t}\n\n\t\twindow.fetch = window._highlightFetchPatch\n\t}\n}\n","import { createNetworkRequestId } from '@highlight-run/client/src/listeners/network-listener/utils/utils'\nimport type { HighlightWebSocketWindow } from '@highlight-run/client/src/listeners/network-listener/utils/web-socket-listener'\n\ndeclare var window: HighlightWebSocketWindow\n\nconst placeholderCallback = () => null\n\nexport const initializeWebSocketListener = () => {\n\tif (typeof window !== 'undefined') {\n\t\t// avoid initializing fetch listener more than once.\n\t\tif (typeof window._highlightWebSocketRequestCallback !== 'undefined') {\n\t\t\treturn\n\t\t}\n\n\t\twindow._highlightWebSocketRequestCallback = placeholderCallback\n\t\twindow._highlightWebSocketEventCallback = placeholderCallback\n\n\t\tconst WebSocketProxy = new Proxy(window.WebSocket, {\n\t\t\tconstruct(\n\t\t\t\ttarget,\n\t\t\t\targs: [url: string, protocols?: string | string[]],\n\t\t\t) {\n\t\t\t\tconst [, socketId] = createNetworkRequestId()\n\t\t\t\tconst webSocket = new target(...args)\n\n\t\t\t\tconst openHandler = (event: Event) => {\n\t\t\t\t\twindow._highlightWebSocketRequestCallback({\n\t\t\t\t\t\tsocketId,\n\t\t\t\t\t\tinitiatorType: 'websocket',\n\t\t\t\t\t\ttype: 'open',\n\t\t\t\t\t\tname: webSocket.url,\n\t\t\t\t\t\tstartTimeAbs: performance.timeOrigin + event.timeStamp,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tconst closeHandler = (event: CloseEvent) => {\n\t\t\t\t\twindow._highlightWebSocketRequestCallback({\n\t\t\t\t\t\tsocketId,\n\t\t\t\t\t\tinitiatorType: 'websocket',\n\t\t\t\t\t\ttype: 'close',\n\t\t\t\t\t\tname: webSocket.url,\n\t\t\t\t\t\tresponseEndAbs:\n\t\t\t\t\t\t\tperformance.timeOrigin + event.timeStamp,\n\t\t\t\t\t})\n\n\t\t\t\t\twebSocket.removeEventListener('open', openHandler)\n\t\t\t\t\twebSocket.removeEventListener('error', errorHandler)\n\t\t\t\t\twebSocket.removeEventListener('message', messageHandler)\n\t\t\t\t\twebSocket.removeEventListener('close', closeHandler)\n\t\t\t\t}\n\n\t\t\t\tconst messageHandler = (event: MessageEvent) => {\n\t\t\t\t\tconst { data } = event\n\t\t\t\t\tconst message =\n\t\t\t\t\t\ttypeof data === 'string' ? event.data : undefined\n\n\t\t\t\t\tlet size: number\n\t\t\t\t\tif (typeof data === 'string') {\n\t\t\t\t\t\tsize = data.length\n\t\t\t\t\t} else if (data instanceof Blob) {\n\t\t\t\t\t\tsize = data.size\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsize = data.byteLength || 0\n\t\t\t\t\t}\n\n\t\t\t\t\twindow._highlightWebSocketEventCallback({\n\t\t\t\t\t\tsocketId,\n\t\t\t\t\t\ttype: 'received',\n\t\t\t\t\t\tname: webSocket.url,\n\t\t\t\t\t\ttimeStamp: performance.timeOrigin + event.timeStamp,\n\t\t\t\t\t\tsize,\n\t\t\t\t\t\tmessage,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tconst errorHandler = (event: Event) => {\n\t\t\t\t\twindow._highlightWebSocketEventCallback({\n\t\t\t\t\t\tsocketId,\n\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\tname: webSocket.url,\n\t\t\t\t\t\ttimeStamp: performance.timeOrigin + event.timeStamp,\n\t\t\t\t\t\tsize: 0,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\twebSocket.addEventListener('open', openHandler)\n\t\t\t\twebSocket.addEventListener('error', errorHandler)\n\t\t\t\twebSocket.addEventListener('message', messageHandler)\n\t\t\t\twebSocket.addEventListener('close', closeHandler)\n\n\t\t\t\tconst sendProxy = new Proxy(webSocket.send, {\n\t\t\t\t\tapply: function (\n\t\t\t\t\t\tsendTarget,\n\t\t\t\t\t\tthisArg,\n\t\t\t\t\t\targs: [data: string | Blob | ArrayBuffer],\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst data = args[0]\n\t\t\t\t\t\tconst message =\n\t\t\t\t\t\t\ttypeof data === 'string' ? data : undefined\n\n\t\t\t\t\t\tlet size: number\n\t\t\t\t\t\tif (typeof data === 'string') {\n\t\t\t\t\t\t\tsize = data.length\n\t\t\t\t\t\t} else if (data instanceof Blob) {\n\t\t\t\t\t\t\tsize = data.size\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsize = data.byteLength || 0\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\twindow._highlightWebSocketEventCallback({\n\t\t\t\t\t\t\tsocketId,\n\t\t\t\t\t\t\ttype: 'sent',\n\t\t\t\t\t\t\tname: webSocket.url,\n\t\t\t\t\t\t\ttimeStamp:\n\t\t\t\t\t\t\t\tperformance.timeOrigin + performance.now(),\n\t\t\t\t\t\t\tsize,\n\t\t\t\t\t\t\tmessage,\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tsendTarget.apply(thisArg, args)\n\t\t\t\t\t},\n\t\t\t\t})\n\n\t\t\t\twebSocket.send = sendProxy\n\n\t\t\t\treturn webSocket\n\t\t\t},\n\t\t})\n\n\t\twindow.WebSocket = WebSocketProxy\n\t}\n}\n","import { H } from '../index'\n\nexport const listenToChromeExtensionMessage = () => {\n\t// typeof checks to see if chrome is defined. chrome is not defined outside of the context of an extension or Chromium browser.\n\tif (typeof chrome !== 'undefined' && chrome?.runtime?.onMessage) {\n\t\tchrome?.runtime?.onMessage.addListener(\n\t\t\t(message, _sender, sendResponse) => {\n\t\t\t\tconst action = message.action\n\t\t\t\tconsole.log(\n\t\t\t\t\t`[highlight] received '${action}' event from extension.`,\n\t\t\t\t)\n\t\t\t\tswitch (action) {\n\t\t\t\t\tcase 'init': {\n\t\t\t\t\t\tH.init(1, {\n\t\t\t\t\t\t\tdebug: true,\n\t\t\t\t\t\t})\n\t\t\t\t\t\tH.getSessionURL().then((url) => {\n\t\t\t\t\t\t\tsendResponse({ url })\n\t\t\t\t\t\t})\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'stop': {\n\t\t\t\t\t\tH.stop()\n\t\t\t\t\t\tsendResponse({ success: true })\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true\n\t\t\t},\n\t\t)\n\t}\n}\n","import {\n\ttype AmplitudeAPI,\n\tsetupAmplitudeIntegration,\n} from './integrations/amplitude.js'\nimport { SESSION_STORAGE_KEYS } from '@highlight-run/client/src/utils/sessionStorage/sessionStorageKeys.js'\nimport type { Highlight, HighlightClassOptions } from '@highlight-run/client'\nimport type {\n\tHighlightOptions,\n\tHighlightPublicInterface,\n\tMetadata,\n\tMetric,\n\tOnHighlightReadyOptions,\n\tSessionDetails,\n} from '@highlight-run/client/src/types/types.js'\nimport {\n\ttype MixpanelAPI,\n\tsetupMixpanelIntegration,\n} from './integrations/mixpanel.js'\n\nimport { FirstLoadListeners } from '@highlight-run/client/src/listeners/first-load-listeners.js'\nimport { GenerateSecureID } from '@highlight-run/client/src/utils/secure-id.js'\nimport { HighlightSegmentMiddleware } from './integrations/segment.js'\nimport configureElectronHighlight from './environments/electron.js'\nimport firstloadVersion from './__generated/version.js'\nimport {\n\tgetPreviousSessionData,\n\tgetSessionSecureID,\n\ttype SessionData,\n} from '@highlight-run/client/src/utils/sessionStorage/highlightSession.js'\nimport { initializeFetchListener } from './listeners/fetch'\nimport { initializeWebSocketListener } from './listeners/web-socket'\nimport { listenToChromeExtensionMessage } from './browserExtension/extensionListener.js'\nimport { setItem } from '@highlight-run/client/src/utils/storage.js'\nimport { ErrorMessageType } from '@highlight-run/client/src/types/shared-types'\n// TODO: Confirm these imports don't change bundle size\nimport type { Context, Span, SpanOptions, Tracer } from '@opentelemetry/api'\nimport { wrap } from 'module'\n\nenum MetricCategory {\n\tDevice = 'Device',\n\tWebVital = 'WebVital',\n\tFrontend = 'Frontend',\n\tBackend = 'Backend',\n}\n\nconst HighlightWarning = (context: string, msg: any) => {\n\tconsole.warn(`highlight.run warning: (${context}): `, msg)\n}\n\ninterface HighlightWindow extends Window {\n\tHighlightIO: new (\n\t\toptions: HighlightClassOptions,\n\t\tfirstLoadListeners: FirstLoadListeners,\n\t) => Highlight\n\tH: HighlightPublicInterface\n\tmixpanel?: MixpanelAPI\n\tamplitude?: AmplitudeAPI\n\tIntercom?: any\n}\n\nconst READY_WAIT_LOOP_MS = 200\n\ndeclare var window: HighlightWindow\n\nlet onHighlightReadyQueue: {\n\toptions?: OnHighlightReadyOptions\n\tfunc: () => void | Promise<void>\n}[] = []\nlet onHighlightReadyTimeout: number | undefined = undefined\n\nlet highlight_obj: Highlight\nlet first_load_listeners: FirstLoadListeners\nlet init_called = false\ntype Callback = (span: Span) => any\nlet getTracer: () => Tracer\nconst H: HighlightPublicInterface = {\n\toptions: undefined,\n\tinit: (projectID?: string | number, options?: HighlightOptions) => {\n\t\ttry {\n\t\t\tH.options = options\n\n\t\t\t// Don't run init when called outside of the browser.\n\t\t\tif (\n\t\t\t\ttypeof window === 'undefined' ||\n\t\t\t\ttypeof document === 'undefined'\n\t\t\t) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Don't initialize if an projectID is not set.\n\t\t\tif (!projectID) {\n\t\t\t\tconsole.info(\n\t\t\t\t\t'Highlight is not initializing because projectID was passed undefined.',\n\t\t\t\t)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tlet previousSession = getPreviousSessionData()\n\t\t\tlet sessionSecureID = GenerateSecureID()\n\t\t\tif (previousSession?.sessionSecureID) {\n\t\t\t\tsessionSecureID = previousSession.sessionSecureID\n\t\t\t} else {\n\t\t\t\tconst sessionData: SessionData = {\n\t\t\t\t\t...previousSession,\n\t\t\t\t\tprojectID: +projectID,\n\t\t\t\t\tsessionSecureID,\n\t\t\t\t}\n\n\t\t\t\tsetItem(\n\t\t\t\t\tSESSION_STORAGE_KEYS.SESSION_DATA,\n\t\t\t\t\tJSON.stringify(sessionData),\n\t\t\t\t)\n\t\t\t}\n\n\t\t\t// `init` was already called, do not reinitialize\n\t\t\tif (init_called) {\n\t\t\t\treturn { sessionSecureID }\n\t\t\t}\n\t\t\tinit_called = true\n\n\t\t\tif (options?.enableOtelTracing) {\n\t\t\t\timport('@highlight-run/client/src/otel').then(\n\t\t\t\t\t({ setupBrowserTracing, getTracer: otelGetTracer }) => {\n\t\t\t\t\t\tsetupBrowserTracing({\n\t\t\t\t\t\t\tendpoint: options?.otlpEndpoint,\n\t\t\t\t\t\t\tprojectId: projectID,\n\t\t\t\t\t\t\tsessionSecureId: sessionSecureID,\n\t\t\t\t\t\t\tenvironment: options?.environment ?? 'production',\n\t\t\t\t\t\t\tnetworkRecordingOptions:\n\t\t\t\t\t\t\t\ttypeof options?.networkRecording === 'object'\n\t\t\t\t\t\t\t\t\t? options.networkRecording\n\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\ttracingOrigins: options?.tracingOrigins,\n\t\t\t\t\t\t\tserviceName:\n\t\t\t\t\t\t\t\toptions?.serviceName ?? 'highlight-browser',\n\t\t\t\t\t\t})\n\t\t\t\t\t\tgetTracer = otelGetTracer\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t}\n\n\t\t\tinitializeFetchListener()\n\t\t\tinitializeWebSocketListener()\n\t\t\timport('@highlight-run/client').then(async ({ Highlight }) => {\n\t\t\t\thighlight_obj = new Highlight(\n\t\t\t\t\tclient_options,\n\t\t\t\t\tfirst_load_listeners,\n\t\t\t\t)\n\t\t\t\tinitializeFetchListener()\n\t\t\t\tinitializeWebSocketListener()\n\t\t\t\tif (!options?.manualStart) {\n\t\t\t\t\tawait highlight_obj.initialize()\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tconst client_options: HighlightClassOptions = {\n\t\t\t\torganizationID: projectID,\n\t\t\t\tdebug: options?.debug,\n\t\t\t\tbackendUrl: options?.backendUrl,\n\t\t\t\ttracingOrigins: options?.tracingOrigins,\n\t\t\t\tdisableNetworkRecording: options?.disableNetworkRecording,\n\t\t\t\tnetworkRecording: options?.networkRecording,\n\t\t\t\tdisableBackgroundRecording: options?.disableBackgroundRecording,\n\t\t\t\tdisableConsoleRecording: options?.disableConsoleRecording,\n\t\t\t\tdisableSessionRecording: options?.disableSessionRecording,\n\t\t\t\treportConsoleErrors: options?.reportConsoleErrors,\n\t\t\t\tconsoleMethodsToRecord: options?.consoleMethodsToRecord,\n\t\t\t\tprivacySetting: options?.privacySetting,\n\t\t\t\tenableSegmentIntegration: options?.enableSegmentIntegration,\n\t\t\t\tenableCanvasRecording: options?.enableCanvasRecording,\n\t\t\t\tenablePerformanceRecording: options?.enablePerformanceRecording,\n\t\t\t\tenablePromisePatch: options?.enablePromisePatch,\n\t\t\t\tsamplingStrategy: options?.samplingStrategy,\n\t\t\t\tinlineImages: options?.inlineImages,\n\t\t\t\tinlineStylesheet: options?.inlineStylesheet,\n\t\t\t\trecordCrossOriginIframe: options?.recordCrossOriginIframe,\n\t\t\t\tfirstloadVersion,\n\t\t\t\tenvironment: options?.environment || 'production',\n\t\t\t\tappVersion: options?.version,\n\t\t\t\tserviceName: options?.serviceName,\n\t\t\t\tsessionShortcut: options?.sessionShortcut,\n\t\t\t\tsessionSecureID: sessionSecureID,\n\t\t\t\tstorageMode: options?.storageMode,\n\t\t\t\tsendMode: options?.sendMode,\n\t\t\t}\n\t\t\tfirst_load_listeners = new FirstLoadListeners(client_options)\n\t\t\tif (!options?.manualStart) {\n\t\t\t\t// Start some of the listeners before client is loaded, then hand the\n\t\t\t\t// listeners over for client to manage\n\t\t\t\tfirst_load_listeners.startListening()\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!options?.integrations?.mixpanel?.disabled &&\n\t\t\t\toptions?.integrations?.mixpanel?.projectToken\n\t\t\t) {\n\t\t\t\tsetupMixpanelIntegration(options.integrations.mixpanel)\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!options?.integrations?.amplitude?.disabled &&\n\t\t\t\toptions?.integrations?.amplitude?.apiKey\n\t\t\t) {\n\t\t\t\tsetupAmplitudeIntegration(options.integrations.amplitude)\n\t\t\t}\n\n\t\t\treturn { sessionSecureID }\n\t\t} catch (e) {\n\t\t\tHighlightWarning('init', e)\n\t\t}\n\t},\n\tsnapshot: async (element: HTMLCanvasElement) => {\n\t\ttry {\n\t\t\tif (highlight_obj && highlight_obj.ready) {\n\t\t\t\treturn await highlight_obj.snapshot(element)\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tHighlightWarning('snapshot', e)\n\t\t}\n\t},\n\taddSessionFeedback: ({\n\t\tverbatim,\n\t\tuserName,\n\t\tuserEmail,\n\t\ttimestampOverride,\n\t}) => {\n\t\ttry {\n\t\t\tH.onHighlightReady(() =>\n\t\t\t\thighlight_obj.addSessionFeedback({\n\t\t\t\t\tverbatim,\n\t\t\t\t\ttimestamp: timestampOverride || new Date().toISOString(),\n\t\t\t\t\tuser_email: userEmail,\n\t\t\t\t\tuser_name: userName,\n\t\t\t\t}),\n\t\t\t)\n\t\t} catch (e) {\n\t\t\tHighlightWarning('error', e)\n\t\t}\n\t},\n\tconsumeError: (\n\t\terror: Error,\n\t\tmessage?: string,\n\t\tpayload?: { [key: string]: string },\n\t) => {\n\t\ttry {\n\t\t\tH.onHighlightReady(() =>\n\t\t\t\thighlight_obj.consumeCustomError(\n\t\t\t\t\terror,\n\t\t\t\t\tmessage,\n\t\t\t\t\tJSON.stringify(payload),\n\t\t\t\t),\n\t\t\t)\n\t\t} catch (e) {\n\t\t\tHighlightWarning('error', e)\n\t\t}\n\t},\n\tconsume: (\n\t\terror: Error,\n\t\topts: {\n\t\t\tmessage?: string\n\t\t\tpayload?: object\n\t\t\tsource?: string\n\t\t\ttype?: ErrorMessageType\n\t\t},\n\t) => {\n\t\ttry {\n\t\t\tH.onHighlightReady(() => highlight_obj.consumeError(error, opts))\n\t\t} catch (e) {\n\t\t\tHighlightWarning('error', e)\n\t\t}\n\t},\n\terror: (message: string, payload?: { [key: string]: string }) => {\n\t\ttry {\n\t\t\tH.onHighlightReady(() =>\n\t\t\t\thighlight_obj.pushCustomError(message, JSON.stringify(payload)),\n\t\t\t)\n\t\t} catch (e) {\n\t\t\tHighlightWarning('error', e)\n\t\t}\n\t},\n\ttrack: (event: string, metadata: Metadata = {}) => {\n\t\ttry {\n\t\t\tH.onHighlightReady(() =>\n\t\t\t\thighlight_obj.addProperties({ ...metadata, event: event }),\n\t\t\t)\n\t\t\tconst highlightUrl = highlight_obj?.getCurrentSessionURL()\n\n\t\t\tif (!H.options?.integrations?.mixpanel?.disabled) {\n\t\t\t\tif (window.mixpanel?.track) {\n\t\t\t\t\twindow.mixpanel.track(event, {\n\t\t\t\t\t\t...metadata,\n\t\t\t\t\t\thighlightSessionURL: highlightUrl,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!H.options?.integrations?.amplitude?.disabled) {\n\t\t\t\tif (window.amplitude?.getInstance) {\n\t\t\t\t\twindow.amplitude.getInstance().logEvent(event, {\n\t\t\t\t\t\t...metadata,\n\t\t\t\t\t\thighlightSessionURL: highlightUrl,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!H.options?.integrations?.intercom?.disabled) {\n\t\t\t\tif (window.Intercom) {\n\t\t\t\t\twindow.Intercom('trackEvent', event, metadata)\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tHighlightWarning('track', e)\n\t\t}\n\t},\n\tstart: (options) => {\n\t\tif (highlight_obj?.state === 'Recording' && !options?.forceNew) {\n\t\t\tif (!options?.silent) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t'Highlight is already recording. Please `H.stop()` the current session before starting a new one.',\n\t\t\t\t)\n\t\t\t}\n\t\t} else {\n\t\t\tfirst_load_listeners.startListening()\n\t\t\tH.onHighlightReady(\n\t\t\t\tasync () => {\n\t\t\t\t\tawait highlight_obj.initialize(options)\n\t\t\t\t},\n\t\t\t\t{ waitForReady: false },\n\t\t\t)\n\t\t}\n\t},\n\tstop: (options) => {\n\t\tif (highlight_obj?.state !== 'Recording') {\n\t\t\tif (!options?.silent) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t'Highlight is already stopped. Please call `H.start()`.',\n\t\t\t\t)\n\t\t\t}\n\t\t} else {\n\t\t\tH.onHighlightReady(() => highlight_obj.stopRecording(true))\n\t\t}\n\t},\n\tidentify: (identifier: string, metadata: Metadata = {}) => {\n\t\ttry {\n\t\t\tH.onHighlightReady(() =>\n\t\t\t\thighlight_obj.identify(identifier, metadata),\n\t\t\t)\n\t\t} catch (e) {\n\t\t\tHighlightWarning('identify', e)\n\t\t}\n\t\tif (!H.options?.integrations?.mixpanel?.disabled) {\n\t\t\tif (window.mixpanel?.identify) {\n\t\t\t\twindow.mixpanel.identify(\n\t\t\t\t\ttypeof metadata?.email === 'string'\n\t\t\t\t\t\t? metadata?.email\n\t\t\t\t\t\t: identifier,\n\t\t\t\t)\n\t\t\t\tif (metadata) {\n\t\t\t\t\twindow.mixpanel.track('identify', metadata)\n\t\t\t\t\twindow.mixpanel.people.set(metadata)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!H.options?.integrations?.amplitude?.disabled) {\n\t\t\tif (window.amplitude?.getInstance) {\n\t\t\t\twindow.amplitude.getInstance().setUserId(identifier)\n\n\t\t\t\tif (Object.keys(metadata).length > 0) {\n\t\t\t\t\tconst amplitudeUserProperties = Object.keys(\n\t\t\t\t\t\tmetadata,\n\t\t\t\t\t).reduce((acc, key) => {\n\t\t\t\t\t\tacc.set(key, metadata[key])\n\n\t\t\t\t\t\treturn acc\n\t\t\t\t\t}, new window.amplitude.Identify())\n\n\t\t\t\t\twindow.amplitude\n\t\t\t\t\t\t.getInstance()\n\t\t\t\t\t\t.identify(amplitudeUserProperties)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tmetrics: (metrics: Metric[]) => {\n\t\ttry {\n\t\t\tH.onHighlightReady(() =>\n\t\t\t\thighlight_obj.recordMetric(\n\t\t\t\t\tmetrics.map((m) => ({\n\t\t\t\t\t\t...m,\n\t\t\t\t\t\tcategory: MetricCategory.Frontend,\n\t\t\t\t\t})),\n\t\t\t\t),\n\t\t\t)\n\t\t} catch (e) {\n\t\t\tHighlightWarning('metrics', e)\n\t\t}\n\t},\n\tstartSpan: (\n\t\tname: string,\n\t\toptions: SpanOptions | ((span: Span) => any),\n\t\tcontext?: Context | ((span: Span) => any),\n\t\tfn?: (span: Span) => any,\n\t): any => {\n\t\tconst tracer = getTracer()\n\n\t\tif (!tracer) {\n\t\t\treturn\n\t\t}\n\n\t\tconst wrapCallback = async (\n\t\t\tspan: Span,\n\t\t\tcallback: (span: Span) => any,\n\t\t) => {\n\t\t\ttry {\n\t\t\t\tconst result = await callback(span)\n\t\t\t\treturn result\n\t\t\t} finally {\n\t\t\t\tspan.end()\n\t\t\t}\n\t\t}\n\n\t\tif (fn === undefined && context === undefined) {\n\t\t\treturn tracer.startActiveSpan(name, (span) =>\n\t\t\t\twrapCallback(span, options as Callback),\n\t\t\t)\n\t\t} else if (fn === undefined) {\n\t\t\treturn tracer.startActiveSpan(\n\t\t\t\tname,\n\t\t\t\toptions as SpanOptions,\n\t\t\t\t(span) => wrapCallback(span, context as Callback),\n\t\t\t)\n\t\t} else {\n\t\t\treturn tracer.startActiveSpan(\n\t\t\t\tname,\n\t\t\t\toptions as SpanOptions,\n\t\t\t\tcontext as Context,\n\t\t\t\t(span) => wrapCallback(span, fn),\n\t\t\t)\n\t\t}\n\t},\n\tstartManualSpan: (\n\t\tname: string,\n\t\toptions: SpanOptions | ((span: Span) => any),\n\t\tcontext?: Context | ((span: Span) => any),\n\t\tfn?: (span: Span) => any,\n\t): any => {\n\t\tif (typeof getTracer !== 'function') {\n\t\t\treturn\n\t\t}\n\n\t\tconst tracer = getTracer()\n\n\t\tif (fn === undefined && context === undefined) {\n\t\t\treturn tracer.startActiveSpan(name, options as Callback)\n\t\t} else if (fn === undefined) {\n\t\t\treturn tracer.startActiveSpan(\n\t\t\t\tname,\n\t\t\t\toptions as SpanOptions,\n\t\t\t\tcontext as Callback,\n\t\t\t)\n\t\t} else {\n\t\t\treturn tracer.startActiveSpan(\n\t\t\t\tname,\n\t\t\t\toptions as SpanOptions,\n\t\t\t\tcontext as Context,\n\t\t\t\tfn,\n\t\t\t)\n\t\t}\n\t},\n\tgetSessionURL: () => {\n\t\treturn new Promise<string>((resolve, reject) => {\n\t\t\tconst res = getSessionSecureID()\n\t\t\tif (res) {\n\t\t\t\tresolve(res)\n\t\t\t} else {\n\t\t\t\treject(new Error('Unable to get session URL'))\n\t\t\t}\n\t\t})\n\t},\n\tgetSessionDetails: () => {\n\t\treturn new Promise<SessionDetails>((resolve, reject) => {\n\t\t\tH.onHighlightReady(() => {\n\t\t\t\tconst baseUrl = highlight_obj.getCurrentSessionURL()\n\t\t\t\tif (baseUrl) {\n\t\t\t\t\tconst currentSessionTimestamp =\n\t\t\t\t\t\thighlight_obj.getCurrentSessionTimestamp()\n\t\t\t\t\tconst now = new Date().getTime()\n\t\t\t\t\tconst url = new URL(baseUrl)\n\t\t\t\t\tconst urlWithTimestamp = new URL(baseUrl)\n\t\t\t\t\turlWithTimestamp.searchParams.set(\n\t\t\t\t\t\t'ts',\n\t\t\t\t\t\t// The delta between when the session recording started and now.\n\t\t\t\t\t\t((now - currentSessionTimestamp) / 1000).toString(),\n\t\t\t\t\t)\n\n\t\t\t\t\tresolve({\n\t\t\t\t\t\turl: url.toString(),\n\t\t\t\t\t\turlWithTimestamp: urlWithTimestamp.toString(),\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error('Could not get session URL'))\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t},\n\tgetRecordingState: () => {\n\t\treturn highlight_obj?.state ?? 'NotRecording'\n\t},\n\tonHighlightReady: (func, options) => {\n\t\tonHighlightReadyQueue.push({ options, func })\n\t\tif (onHighlightReadyTimeout === undefined) {\n\t\t\tconst fn = () => {\n\t\t\t\tconst newOnHighlightReadyQueue: {\n\t\t\t\t\toptions?: OnHighlightReadyOptions\n\t\t\t\t\tfunc: () => void | Promise<void>\n\t\t\t\t}[] = []\n\t\t\t\tfor (const f of onHighlightReadyQueue) {\n\t\t\t\t\tif (\n\t\t\t\t\t\thighlight_obj &&\n\t\t\t\t\t\t(f.options?.waitForReady === false ||\n\t\t\t\t\t\t\thighlight_obj.ready)\n\t\t\t\t\t) {\n\t\t\t\t\t\tf.func()\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewOnHighlightReadyQueue.push(f)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tonHighlightReadyQueue = newOnHighlightReadyQueue\n\t\t\t\tonHighlightReadyTimeout = undefined\n\t\t\t\tif (onHighlightReadyQueue.length > 0) {\n\t\t\t\t\tonHighlightReadyTimeout = setTimeout(\n\t\t\t\t\t\tfn,\n\t\t\t\t\t\tREADY_WAIT_LOOP_MS,\n\t\t\t\t\t) as unknown as number\n\t\t\t\t}\n\t\t\t}\n\t\t\tfn()\n\t\t}\n\t},\n}\n\nif (typeof window !== 'undefined') {\n\twindow.H = H\n}\n\nlistenToChromeExtensionMessage()\ninitializeFetchListener()\ninitializeWebSocketListener()\n\nexport type { HighlightOptions }\nexport {\n\tH,\n\tHighlightSegmentMiddleware,\n\tMetricCategory,\n\tconfigureElectronHighlight,\n}\n"],"names":["setupAmplitudeIntegration","apiKey","t","n","r","i","s","e","o","a","u","l","p","d","v","SESSION_STORAGE_KEYS","setupMixpanelIntegration","projectToken","f","b","h","c","g","j","script","MixpanelBundle","_a","patch","source","name","replacement","original","wrapped","pathToSelector","node","path","parent","domSiblings","sibling","isObject","obj","isObjTooDeep","limit","keys","key","stringify","stringifyOptions","options","stack","value","thisPos","shouldIgnore","toString","eventResult","eventKey","eventValue","_obj","str","root","factory","module","this","_isNumber","_capitalize","_getter","booleanProps","numericProps","stringProps","arrayProps","objectProps","props","StackFrame","fileName","lineNumber","columnNumber","functionName","argsStartIndex","argsEndIndex","args","locationString","parts","k","require$$0","FIREFOX_SAFARI_STACK_REGEXP","CHROME_IE_STACK_REGEXP","SAFARI_NATIVE_CODE_REGEXP","error","urlLike","regExp","filtered","line","sanitizedLine","location","tokens","locationParts","functionNameRegex","matches","lineRE","lines","result","len","match","functionCall","argsRaw","ConsoleListener","callback","logOptions","loggerType","logger","cancelHandlers","errorHandler","event","message","trace","ErrorStackParser","payload","levelType","replace","_logger","level","data","__spreadValues","exports","serializer","replacer","spaces","cycleReplacer","handleError","_b","_c","_d","res","framesToUse","removeHighlightFrameIfExists","ErrorListener","enablePromisePatch","initialOnError","lineno","colno","initialOnUnhandledRejection","hPromise","initialPromise","highlightPromise","executor","__publicField","zoneUndefined","frames","firstFrame","ALL_CONSOLE_METHODS","MetricName","MetricCategory","ERRORS_TO_IGNORE","ERROR_PATTERNS_TO_IGNORE","sanitizeResource","resource","headersToRedact","headersToRecord","newHeaders","sanitizeHeaders","__spreadProps","headers","header","SENSITIVE_HEADERS","DEFAULT_URL_BLOCKLIST","mode","Storage","globalStorage","getPersistentStorage","getItem","setItem","SESSION_PUSH_THRESHOLD","getPreviousSessionData","storedSessionData","getSessionSecureID","HIGHLIGHT_REQUEST_HEADER","normalizeUrl","url","urlToMutate","sanitizeRequestResponsePair","pair","requestResponseSanitizer","sanitizedPair","stringifyRequestBody","err","stringifyResponseBody","request","response","rest","__objRest","matchPerformanceTimingsWithRequestResponsePair","performanceTimings","requestResponsePairs","type","sanitizeOptions","initialGroupedPerformanceTimings","groupedPerformanceTimings","previous","performanceTiming","groupedRequestResponsePairs","requestResponsePair","performanceTimingsForUrl","requestResponsePairsForUrl","offset","resources","isHighlightNetworkResourceFilter","backendUrl","define_import_meta_env_default","shouldNetworkRequestBeRecorded","highlightBackendUrl","tracingOrigins","shouldNetworkRequestBeTraced","patterns","pattern","makeId","length","characters","charactersLength","createNetworkRequestId","getHighlightRequestHeader","sessionSecureID","requestId","XHRListener","urlBlocklist","bodyKeysToRedact","bodyKeysToRecord","XHR","originalOpen","originalSend","originalSetRequestHeader","method","blockedUrl","postData","shouldRecordHeaderAndBody","requestModel","bodyData","getBodyData","getBodyThatShouldBeRecorded","__async","responseModel","normalizedResponseHeaders","headerMap","DEFAULT_BODY_LIMIT","BODY_SIZE_LIMITS","bodyLimit","contentType","json","element","FetchListener","originalFetch","input","init","getFetchRequestProperties","responsePromise","logRequest","requestPayload","onPromiseResolveHandler","responsePayload","requestHandled","urlBlocked","getResponseBody","text","body","reader","utf8Decoder","nextChunk","partialData","WebSocketListener","requestCallback","eventCallback","initialHighlightWebSocketRequestCallback","initialHighlightWebSocketEventCallback","eventData","size","visibleEventData","redactedEventData","NetworkListener","xhrCallback","fetchCallback","webSocketRequestCallback","webSocketEventCallback","disableWebSocketRecording","removeXHRListener","removeFetchListener","removeWebSocketListener","FirstLoadListeners","highlightThis","errorValue","shutdown","stop","sThis","_e","_f","_g","_h","_i","_j","_k","_l","bodyKey","recordingStartTime","httpResources","webSocketResources","documentTimeOrigin","webSocketEvents","GenerateSecureID","CHARACTER_SET","secureID","hasCrypto","cryptoRandom","HighlightSegmentMiddleware","next","trackEventName","trackEventProperties","identifier","identifyMetadata","configureElectronHighlight","window","firstloadVersion","initializeFetchListener","placeholderCallback","initializeWebSocketListener","WebSocketProxy","target","socketId","webSocket","openHandler","closeHandler","messageHandler","sendProxy","sendTarget","thisArg","listenToChromeExtensionMessage","_sender","sendResponse","action","H","HighlightWarning","context","msg","READY_WAIT_LOOP_MS","onHighlightReadyQueue","onHighlightReadyTimeout","highlight_obj","first_load_listeners","init_called","getTracer","projectID","previousSession","sessionData","setupBrowserTracing","otelGetTracer","_0","Highlight","client_options","verbatim","userName","userEmail","timestampOverride","opts","metadata","highlightUrl","amplitudeUserProperties","acc","metrics","m","fn","tracer","wrapCallback","span","resolve","reject","baseUrl","currentSessionTimestamp","now","urlWithTimestamp","func","newOnHighlightReadyQueue"],"mappings":"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","x_google_ignoreList":[4,5,7]}